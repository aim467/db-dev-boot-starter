import{u as I,t as O,d as P}from"./datasource-CGHvgTzV.js";import{_ as j}from"./index-B8Sf_DuM.js";import{a as c,b as J,c as K}from"./element-plus-Cxi87m0O.js";import{x as U,m as f,C as t,ay as o,aI as q,o as p,J as F,A as G,u as d,B as e,M as _,D as m,K as x,O as y}from"./vue-vendor-yGlHWbnf.js";import"./vendor-BTz0EEYM.js";const H={style:{display:"flex","align-items":"center","justify-content":"space-between"}},W={style:{display:"flex","align-items":"center",gap:"8px"}},X={style:{display:"flex",gap:"8px"}},Y={style:{display:"flex","align-items":"center",gap:"8px"}},Z={__name:"DataSources",setup(ee){const l=I(),v=a=>({MySQL:"success",PostgreSQL:"warning",Oracle:"danger","SQL Server":"info"})[a]||"info",g=async()=>{try{await l.loadDataSources(),c.success(`成功加载 ${l.dataSources.length} 个数据源`)}catch(a){c.error("加载数据源失败: "+a.message)}},b=async a=>{try{await O(a.name),c.success(`数据源 "${a.name}" 连接成功`),a.status="success"}catch{c.error(`数据源 "${a.name}" 连接失败`),a.status="error"}},D=async()=>{const a=K.service({lock:!0,text:"正在测试所有连接...",background:"rgba(0, 0, 0, 0.7)"});try{const n=l.dataSources.map(w=>b(w));await Promise.all(n),c.success("所有连接测试完成")}finally{a.close()}},S=a=>{c.info(`编辑数据源: ${a.name}`)},z=a=>{J.confirm(`确定要删除数据源 "${a.name}" 吗？`,"提示",{type:"warning"}).then(async()=>{try{await P(a.name),c.success("删除成功"),g()}catch(n){c.error("删除失败: "+n.message)}}).catch(()=>{})};return U(()=>{g()}),(a,n)=>{const w=o("Connection"),r=o("el-icon"),h=o("el-tag"),$=o("Refresh"),u=o("el-button"),C=o("Link"),L=o("el-empty"),M=o("Star"),i=o("el-table-column"),B=o("el-text"),E=o("CircleCheck"),T=o("Edit"),N=o("Delete"),V=o("el-button-group"),Q=o("el-table"),R=o("el-card"),A=q("loading");return p(),f(R,{shadow:"hover"},{header:t(()=>[m("div",H,[m("div",W,[e(r,null,{default:t(()=>[e(w)]),_:1}),n[0]||(n[0]=m("span",{style:{"font-weight":"600"}},"数据源列表",-1)),d(l).dataSources.length>0?(p(),f(h,{key:0,type:"info",size:"small"},{default:t(()=>[_(y(d(l).dataSources.length),1)]),_:1})):x("",!0)]),m("div",X,[e(u,{type:"primary",size:"small",onClick:g,loading:d(l).loading},{default:t(()=>[e(r,null,{default:t(()=>[e($)]),_:1}),n[1]||(n[1]=_(" 刷新 ",-1))]),_:1},8,["loading"]),e(u,{type:"success",size:"small",onClick:D},{default:t(()=>[e(r,null,{default:t(()=>[e(C)]),_:1}),n[2]||(n[2]=_(" 测试连接 ",-1))]),_:1})])])]),default:t(()=>[F((p(),G("div",null,[!d(l).loading&&d(l).dataSources.length===0?(p(),f(L,{key:0,description:"未找到数据源"},{default:t(()=>[e(u,{type:"primary",size:"small"},{default:t(()=>[...n[3]||(n[3]=[_("添加数据源",-1)])]),_:1})]),_:1})):(p(),f(Q,{key:1,data:d(l).dataSources,stripe:"",style:{width:"100%"},height:"500"},{default:t(()=>[e(i,{prop:"name",label:"名称",width:"200",fixed:""},{default:t(s=>[m("div",Y,[s.row.primary?(p(),f(r,{key:0,color:"#f56c6c"},{default:t(()=>[e(M)]),_:1})):x("",!0),m("strong",null,y(s.row.name),1)])]),_:1}),e(i,{prop:"databaseType",label:"数据库类型",width:"150"},{default:t(s=>[e(h,{type:v(s.row.databaseType),size:"small"},{default:t(()=>[_(y(s.row.databaseType),1)]),_:2},1032,["type"])]),_:1}),e(i,{prop:"type",label:"连接池类型",width:"180"}),e(i,{prop:"url",label:"URL","min-width":"300","show-overflow-tooltip":""},{default:t(s=>[e(B,{type:"info",size:"small",style:{"font-family":"monospace"}},{default:t(()=>[_(y(s.row.url),1)]),_:2},1024)]),_:1}),e(i,{prop:"username",label:"用户名",width:"120"}),e(i,{label:"状态",width:"120"},{default:t(s=>[e(h,{type:s.row.status||"success",size:"small"},{default:t(()=>[e(r,null,{default:t(()=>[e(E)]),_:1}),_(" "+y(s.row.status==="error"?"连接失败":"已连接"),1)]),_:2},1032,["type"])]),_:1}),e(i,{label:"操作",width:"150",fixed:"right"},{default:t(s=>[e(V,null,{default:t(()=>[e(u,{type:"primary",size:"small",onClick:k=>b(s.row)},{default:t(()=>[e(r,null,{default:t(()=>[e(C)]),_:1})]),_:1},8,["onClick"]),e(u,{type:"warning",size:"small",onClick:k=>S(s.row)},{default:t(()=>[e(r,null,{default:t(()=>[e(T)]),_:1})]),_:1},8,["onClick"]),e(u,{type:"danger",size:"small",onClick:k=>z(s.row)},{default:t(()=>[e(r,null,{default:t(()=>[e(N)]),_:1})]),_:1},8,["onClick"])]),_:2},1024)]),_:1})]),_:1},8,["data"]))])),[[A,d(l).loading]])]),_:1})}}},le=j(Z,[["__scopeId","data-v-23521ff2"]]);export{le as default};
