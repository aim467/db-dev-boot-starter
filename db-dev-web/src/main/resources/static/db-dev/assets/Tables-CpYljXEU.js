import{u as J}from"./datasource-BB4_IJ-g.js";import{g as G,a as H}from"./metadata-BvLBKV1p.js";import{_ as q}from"./index-C9u0Vdbf.js";import{b as C,e as W}from"./element-plus-DuTa5cwT.js";import{c as B,m as b,o as d,C as e,B as t,ay as l,D as c,K as D,O as p,M as u,A as S,ac as K,P as Q,r as z,x as X,aI as Z,u as ee,J as te}from"./vue-vendor-BB5k324P.js";import"./datasource-CNDQnR3F.js";import"./request-CcLfhpZL.js";import"./vendor-BTz0EEYM.js";const le={style:{display:"flex","align-items":"center","justify-content":"space-between"}},ae={style:{display:"flex","align-items":"center",gap:"8px"}},ne={style:{"font-weight":"600"}},oe={style:{display:"flex",gap:"8px"}},se={style:{display:"flex","align-items":"center",gap:"4px"}},re={style:{display:"flex","align-items":"center",gap:"6px"}},ie={key:1},ue={style:{display:"flex","align-items":"center",gap:"4px"}},ce={style:{display:"flex","flex-wrap":"wrap",gap:"4px"}},pe={key:0,style:{color:"#909399","margin-left":"2px"}},de={style:{display:"flex","align-items":"center",gap:"4px"}},me={style:{display:"flex","align-items":"center","justify-content":"space-between"}},_e={__name:"TableDetail",props:{table:{type:Object,required:!0}},emits:["close"],setup(x){const y=x,v=B(()=>{if(!y.table?.indexes||y.table.indexes.length===0)return[];const _=new Map;return y.table.indexes.forEach(a=>{const g=a.indexName;_.has(g)||_.set(g,{indexName:a.indexName,unique:a.unique,type:a.type,columns:[]}),_.get(g).columns.push({columnName:a.columnName,ascOrDesc:a.ascOrDesc||"ASC"})}),Array.from(_.values())}),w=B(()=>{if(!y.table||!y.table.columns)return"";const _=y.table.tableName,a=[],g=y.table.columns.map(n=>{let r=`  \`${n.columnName}\` ${n.typeName}`;return n.columnSize>0&&(r+=`(${n.columnSize})`),n.nullable||(r+=" NOT NULL"),n.autoIncrement&&(r+=" AUTO_INCREMENT"),n.columnDef&&(r+=` DEFAULT '${n.columnDef}'`),n.remarks&&(r+=` COMMENT '${n.remarks}'`),r});a.push(...g);const m=y.table.columns.filter(n=>n.primaryKey);if(m.length>0){const n=m.map(r=>`\`${r.columnName}\``).join(", ");a.push(`  PRIMARY KEY (${n})`)}return v.value.length>0&&v.value.forEach(n=>{if(n.indexName==="PRIMARY")return;const r=n.columns.map(o=>`\`${o.columnName}\``).join(", ");n.unique?a.push(`  UNIQUE KEY \`${n.indexName}\` (${r})`):a.push(`  KEY \`${n.indexName}\` (${r})`)}),`CREATE TABLE \`${_}\` (
${a.join(`,
`)}
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='${y.table.remarks||""}';`}),N=()=>{const _=JSON.stringify(y.table,null,2),a=new Blob([_],{type:"application/json"}),g=URL.createObjectURL(a),m=document.createElement("a");m.href=g,m.download=`${y.table.tableName}.json`,m.click(),URL.revokeObjectURL(g),C.success("导出成功")},k=()=>{navigator.clipboard.writeText(w.value).then(()=>{C.success("SQL已复制到剪贴板")}).catch(()=>{C.error("复制失败")})};return(_,a)=>{const g=l("Document"),m=l("el-icon"),n=l("el-tag"),r=l("Download"),o=l("el-button"),T=l("Close"),h=l("List"),M=l("Key"),f=l("el-table-column"),A=l("el-table"),$=l("el-tab-pane"),O=l("el-empty"),R=l("DocumentCopy"),V=l("el-input"),I=l("el-card"),U=l("el-tabs");return d(),b(I,{shadow:"hover"},{header:e(()=>[c("div",le,[c("div",ae,[t(m,null,{default:e(()=>[t(g)]),_:1}),c("span",ne,"表详情: "+p(x.table.tableName),1),x.table.tableType?(d(),b(n,{key:0,type:"info",size:"small"},{default:e(()=>[u(p(x.table.tableType),1)]),_:1})):D("",!0)]),c("div",oe,[t(o,{type:"primary",size:"small",onClick:N},{default:e(()=>[t(m,null,{default:e(()=>[t(r)]),_:1}),a[1]||(a[1]=u(" 导出 ",-1))]),_:1}),t(o,{size:"small",onClick:a[0]||(a[0]=s=>_.$emit("close"))},{default:e(()=>[t(m,null,{default:e(()=>[t(T)]),_:1}),a[2]||(a[2]=u(" 关闭 ",-1))]),_:1})])])]),default:e(()=>[t(U,{type:"border-card"},{default:e(()=>[t($,null,{label:e(()=>[c("span",se,[t(m,null,{default:e(()=>[t(h)]),_:1}),u(" 字段信息 ("+p(x.table.columns?.length||0)+") ",1)])]),default:e(()=>[t(A,{data:x.table.columns,stripe:"",border:"",style:{width:"100%"},height:"400"},{default:e(()=>[t(f,{prop:"columnName",label:"字段名",width:"180",fixed:""},{default:e(s=>[c("div",re,[s.row.primaryKey?(d(),b(m,{key:0,color:"#f56c6c",size:"14"},{default:e(()=>[t(M)]),_:1})):D("",!0),c("strong",null,p(s.row.columnName),1)])]),_:1}),t(f,{prop:"typeName",label:"类型",width:"120",sortable:""}),t(f,{prop:"columnSize",label:"大小",width:"80",sortable:""},{default:e(s=>[u(p(s.row.columnSize>0?s.row.columnSize:"-"),1)]),_:1}),t(f,{label:"可空",width:"80",sortable:""},{default:e(s=>[t(n,{type:s.row.nullable?"info":"warning",size:"small"},{default:e(()=>[u(p(s.row.nullable?"是":"否"),1)]),_:2},1032,["type"])]),_:1}),t(f,{prop:"columnDef",label:"默认值",width:"120"},{default:e(s=>[u(p(s.row.defaultValue||"-"),1)]),_:1}),t(f,{prop:"remarks",label:"备注","min-width":"200","show-overflow-tooltip":""},{default:e(s=>[u(p(s.row.remarks||"-"),1)]),_:1}),t(f,{label:"自增",width:"80"},{default:e(s=>[s.row.autoIncrement?(d(),b(n,{key:0,type:"success",size:"small"},{default:e(()=>[...a[3]||(a[3]=[u("是",-1)])]),_:1})):(d(),S("span",ie,"-"))]),_:1})]),_:1},8,["data"])]),_:1}),t($,null,{label:e(()=>[c("span",ue,[t(m,null,{default:e(()=>[t(M)]),_:1}),u(" 索引信息 ("+p(v.value.length)+") ",1)])]),default:e(()=>[v.value.length===0?(d(),b(O,{key:0,description:"无索引信息"})):(d(),b(A,{key:1,data:v.value,stripe:"",border:"",style:{width:"100%"}},{default:e(()=>[t(f,{prop:"indexName",label:"索引名",width:"200"}),t(f,{label:"包含列","min-width":"250"},{default:e(s=>[c("div",ce,[(d(!0),S(Q,null,K(s.row.columns,(E,j)=>(d(),b(n,{key:j,size:"small",type:"info"},{default:e(()=>[u(p(E.columnName)+" ",1),E.ascOrDesc?(d(),S("span",pe," ("+p(E.ascOrDesc)+") ",1)):D("",!0)]),_:2},1024))),128))])]),_:1}),t(f,{label:"唯一",width:"100"},{default:e(s=>[t(n,{type:s.row.unique?"success":"info",size:"small"},{default:e(()=>[u(p(s.row.unique?"是":"否"),1)]),_:2},1032,["type"])]),_:1}),t(f,{prop:"type",label:"类型",width:"150"},{default:e(s=>[u(p(s.row.type||"-"),1)]),_:1})]),_:1},8,["data"]))]),_:1}),t($,null,{label:e(()=>[c("span",de,[t(m,null,{default:e(()=>[t(R)]),_:1}),a[4]||(a[4]=u(" SQL预览 ",-1))])]),default:e(()=>[t(I,{shadow:"never"},{header:e(()=>[c("div",me,[a[6]||(a[6]=c("span",null,"CREATE TABLE 语句",-1)),t(o,{type:"primary",size:"small",onClick:k},{default:e(()=>[t(m,null,{default:e(()=>[t(R)]),_:1}),a[5]||(a[5]=u(" 复制 ",-1))]),_:1})])]),default:e(()=>[t(V,{type:"textarea",rows:15,"model-value":w.value,readonly:"",style:{"font-family":"'Courier New', monospace"}},null,8,["model-value"])]),_:1})]),_:1})]),_:1})]),_:1})}}},fe=q(_e,[["__scopeId","data-v-de204c1e"]]),ye={style:{display:"flex","align-items":"center",gap:"8px"}},be={style:{display:"flex","align-items":"center",gap:"8px"}},ge={style:{display:"flex","align-items":"center","justify-content":"space-between"}},ve={style:{display:"flex","align-items":"center",gap:"8px"}},we={style:{display:"flex",gap:"8px"}},he={style:{display:"flex","align-items":"center",gap:"8px"}},xe={__name:"Tables",setup(x){const y=J(),v=z(""),w=z([]),N=z(""),k=z(!1),_=z(null),a=r=>({MySQL:"success",PostgreSQL:"warning",Oracle:"danger","SQL Server":"info"})[r]||"info",g=B(()=>{if(!N.value)return w.value;const r=N.value.toLowerCase();return w.value.filter(o=>o.tableName.toLowerCase().includes(r))}),m=async()=>{if(v.value){k.value=!0,_.value=null,N.value="";try{const r=await G(v.value);w.value=r.data,C.success(`成功加载 ${w.value.length} 个表`)}catch(r){C.error("加载表列表失败: "+r.message)}finally{k.value=!1}}},n=async r=>{const o=W.service({lock:!0,text:"正在加载表详情...",background:"rgba(0, 0, 0, 0.7)"});try{const T=await H(r,v.value);_.value=T.data,C.success("加载表详情成功")}catch(T){C.error("加载表详情失败: "+T.message)}finally{o.close()}};return X(async()=>{y.dataSources.length===0&&await y.loadDataSources()}),(r,o)=>{const T=l("Setting"),h=l("el-icon"),M=l("Star"),f=l("el-tag"),A=l("el-option"),$=l("el-select"),O=l("el-card"),R=l("Folder"),V=l("Search"),I=l("el-input"),U=l("Refresh"),s=l("el-button"),E=l("el-empty"),j=l("Document"),L=l("el-table-column"),F=l("View"),Y=l("el-table"),P=Z("loading");return d(),S("div",null,[t(O,{shadow:"hover",style:{"margin-bottom":"20px"}},{header:e(()=>[c("div",ye,[t(h,null,{default:e(()=>[t(T)]),_:1}),o[3]||(o[3]=c("span",{style:{"font-weight":"600"}},"数据源选择",-1))])]),default:e(()=>[t($,{modelValue:v.value,"onUpdate:modelValue":o[0]||(o[0]=i=>v.value=i),placeholder:"请选择数据源",style:{width:"300px"},onChange:m,clearable:""},{default:e(()=>[(d(!0),S(Q,null,K(ee(y).dataSources,i=>(d(),b(A,{key:i.name,label:i.name,value:i.name},{default:e(()=>[c("div",be,[i.primary?(d(),b(h,{key:0,color:"#f56c6c"},{default:e(()=>[t(M)]),_:1})):D("",!0),c("span",null,p(i.name),1),t(f,{size:"small",type:a(i.databaseType)},{default:e(()=>[u(p(i.databaseType),1)]),_:2},1032,["type"])])]),_:2},1032,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),v.value?(d(),b(O,{key:0,shadow:"hover",style:{"margin-bottom":"20px"}},{header:e(()=>[c("div",ge,[c("div",ve,[t(h,null,{default:e(()=>[t(R)]),_:1}),o[4]||(o[4]=c("span",{style:{"font-weight":"600"}},"表列表",-1)),w.value.length>0?(d(),b(f,{key:0,type:"info",size:"small"},{default:e(()=>[u(p(w.value.length),1)]),_:1})):D("",!0)]),c("div",we,[t(I,{modelValue:N.value,"onUpdate:modelValue":o[1]||(o[1]=i=>N.value=i),placeholder:"搜索表名",style:{width:"200px"},clearable:""},{prefix:e(()=>[t(h,null,{default:e(()=>[t(V)]),_:1})]),_:1},8,["modelValue"]),t(s,{type:"primary",size:"small",onClick:m,loading:k.value},{default:e(()=>[t(h,null,{default:e(()=>[t(U)]),_:1}),o[5]||(o[5]=u(" 刷新 ",-1))]),_:1},8,["loading"])])])]),default:e(()=>[te((d(),S("div",null,[!k.value&&g.value.length===0?(d(),b(E,{key:0,description:"未找到表"})):(d(),b(Y,{key:1,data:g.value,stripe:"",style:{width:"100%"},height:"400"},{default:e(()=>[t(L,{prop:"tableName",label:"表名","min-width":"200",sortable:""},{default:e(i=>[c("div",he,[t(h,{color:"#409eff"},{default:e(()=>[t(j)]),_:1}),c("strong",null,p(i.row.tableName),1)])]),_:1}),t(L,{prop:"tableType",label:"类型",width:"120",sortable:""},{default:e(i=>[t(f,{type:i.row.tableType==="TABLE"?"success":"info",size:"small"},{default:e(()=>[u(p(i.row.tableType),1)]),_:2},1032,["type"])]),_:1}),t(L,{prop:"remarks",label:"备注","min-width":"200","show-overflow-tooltip":""},{default:e(i=>[u(p(i.row.remarks||"-"),1)]),_:1}),t(L,{prop:"columnCount",label:"字段数",width:"100",sortable:""},{default:e(i=>[t(f,{size:"small"},{default:e(()=>[u(p(i.row.columnCount||0),1)]),_:2},1024)]),_:1}),t(L,{label:"操作",width:"150",fixed:"right"},{default:e(i=>[t(s,{type:"primary",size:"small",onClick:Ne=>n(i.row.tableName)},{default:e(()=>[t(h,null,{default:e(()=>[t(F)]),_:1}),o[6]||(o[6]=u(" 详情 ",-1))]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"]))])),[[P,k.value]])]),_:1})):D("",!0),_.value?(d(),b(fe,{key:1,table:_.value,onClose:o[2]||(o[2]=i=>_.value=null)},null,8,["table"])):D("",!0)])}}},ze=q(xe,[["__scopeId","data-v-512160b0"]]);export{ze as default};
