import{a as ye}from"./datasource-CNDQnR3F.js";import{g as we,a as Ve}from"./metadata-BvLBKV1p.js";import{r as K}from"./request-CcLfhpZL.js";import{_ as Ce}from"./index-C9u0Vdbf.js";import{b as g}from"./element-plus-DuTa5cwT.js";import{r as i,_ as ke,c as he,A as x,B as a,m as b,K as D,C as l,ay as n,o as d,D as r,P as O,ac as q,O as _,M as u,L as xe,F as Ne}from"./vue-vendor-BB5k324P.js";import"./vendor-BTz0EEYM.js";const Le=N=>K.post("/codegen/generate",N),Se=N=>K.post("/codegen/preview",N),Te={class:"codegen-container"},Ue={class:"card-header"},De={class:"header-left"},Pe={class:"section-title"},Ee={class:"ds-option"},Me={class:"table-option"},je={key:0,class:"table-remarks"},Re={class:"collapse-title"},ze={class:"checkbox-group"},Oe={class:"action-buttons"},qe={class:"card-header"},Be={class:"header-left"},Je={class:"column-count"},Fe={class:"card-header"},Ge={class:"header-left"},Ae={class:"code-wrapper"},Ke={class:"code-toolbar"},Xe={class:"file-type"},Ie={class:"code-content"},$e={__name:"CodeGen",setup(N){const L=i(),B=i([]),P=i([]),v=i([]),f=i({}),E=i(!1),M=i(!1),J=i([]),S=i(""),F=i(""),s=ke({dataSourceName:"",tableName:"",basePackage:"com.example.project",author:"DB Dev",generateTypes:[],overwrite:!0,entity:{useLombok:!0,useJpa:!1,useSwagger:!1,superClass:""},mapper:{suffix:"Mapper",superClass:""},xml:{directory:"mapper"},repository:{suffix:"Repository",useJpa:!0}}),X={dataSourceName:[{required:!0,message:"请选择数据源",trigger:"change"}],tableName:[{required:!0,message:"请选择表",trigger:"change"}],basePackage:[{required:!0,message:"请输入基础包名",trigger:"blur"}],author:[{required:!0,message:"请输入作者名称",trigger:"blur"}]},I=he(()=>Object.keys(f.value).length>0),$=o=>({mysql:"success",postgresql:"primary",oracle:"warning",sqlserver:""})[o?.toLowerCase()]||"info",Y=o=>({entity:"Entity",mapper:"Mapper",xml:"XML",repository:"Repository",service:"Service",controller:"Controller"})[o?.toLowerCase()]||o,H=o=>o?.toLowerCase()==="xml"?".xml":".java",Q=o=>o?.toLowerCase()==="xml"?"language-xml":"language-java",W=async()=>{try{const o=await ye();B.value=o.data||[]}catch(o){console.error("加载数据源失败:",o)}},Z=async o=>{if(s.tableName="",v.value=[],f.value={},o)try{const e=await we(o);P.value=e.data||[]}catch(e){console.error("加载表列表失败:",e),P.value=[]}},ee=async o=>{if(f.value={},o&&s.dataSourceName)try{const e=await Ve(o,s.dataSourceName);v.value=e.data?.columns||[]}catch(e){console.error("加载表结构失败:",e),v.value=[]}},ae=async()=>{try{await L.value.validate(),E.value=!0;const o={...s,outputDir:null},e=await Se(o);e.code===200?(f.value=e.data,S.value=Object.keys(e.data)[0]||"",g.success("代码预览成功")):g.error(e.message||"预览失败")}catch(o){console.error("预览失败:",o),g.error(o.response?.data?.message||o.message||"预览失败")}finally{E.value=!1}},le=async()=>{try{await L.value.validate(),M.value=!0;const o=await Le(s);if(o.code===200){g.success("代码生成成功，正在下载..."),f.value=o.data.files,S.value=Object.keys(o.data.files)[0]||"",F.value=o.data.downloadUrl;const e=document.createElement("a");e.href=o.data.downloadUrl,e.download=o.data.fileName,document.body.appendChild(e),e.click(),document.body.removeChild(e)}else g.error(o.message||"生成失败")}catch(o){console.error("生成失败:",o),g.error(o.response?.data?.message||o.message||"生成失败")}finally{M.value=!1}},G=async o=>{try{await navigator.clipboard.writeText(o),g.success("已复制到剪贴板")}catch{g.error("复制失败")}},te=async()=>{const o=Object.entries(f.value).map(([e,j])=>`// ========== ${e.toUpperCase()} ==========
${j}`).join(`

`);await G(o)},oe=()=>{L.value?.resetFields(),f.value={},v.value=[],F.value="",s.entity.useLombok=!0,s.entity.useJpa=!1,s.entity.useSwagger=!1,s.overwrite=!1};return W(),(o,e)=>{const j=n("Tools"),p=n("el-icon"),V=n("el-tag"),se=n("Setting"),y=n("el-option"),R=n("el-select"),m=n("el-form-item"),c=n("el-col"),T=n("el-row"),C=n("el-input"),ne=n("Operation"),U=n("el-checkbox"),re=n("el-collapse-item"),ue=n("el-collapse"),de=n("Refresh"),k=n("el-button"),pe=n("View"),ie=n("Download"),me=n("el-form"),z=n("el-card"),ce=n("Grid"),w=n("el-table-column"),_e=n("el-table"),fe=n("Document"),A=n("DocumentCopy"),ge=n("el-button-group"),ve=n("el-tab-pane"),be=n("el-tabs");return d(),x("div",Te,[a(z,{shadow:"hover",class:"config-card"},{header:l(()=>[r("div",Ue,[r("div",De,[a(p,null,{default:l(()=>[a(j)]),_:1}),e[14]||(e[14]=r("span",{class:"header-title"},"代码生成器",-1))]),a(V,{type:"success",size:"small"},{default:l(()=>[...e[15]||(e[15]=[u("v1.0",-1)])]),_:1})])]),default:l(()=>[a(me,{ref_key:"formRef",ref:L,model:s,"label-width":"100px",rules:X},{default:l(()=>[r("div",Pe,[a(p,null,{default:l(()=>[a(se)]),_:1}),e[16]||(e[16]=r("span",null,"基础配置",-1))]),a(T,{gutter:24},{default:l(()=>[a(c,{span:8},{default:l(()=>[a(m,{label:"数据源",prop:"dataSourceName"},{default:l(()=>[a(R,{modelValue:s.dataSourceName,"onUpdate:modelValue":e[0]||(e[0]=t=>s.dataSourceName=t),placeholder:"请选择数据源",style:{width:"100%"},onChange:Z},{default:l(()=>[(d(!0),x(O,null,q(B.value,t=>(d(),b(y,{key:t.name,label:t.name,value:t.name},{default:l(()=>[r("div",Ee,[r("span",null,_(t.name),1),a(V,{size:"small",type:$(t.type)},{default:l(()=>[u(_(t.type),1)]),_:2},1032,["type"])])]),_:2},1032,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1}),a(c,{span:8},{default:l(()=>[a(m,{label:"数据表",prop:"tableName"},{default:l(()=>[a(R,{modelValue:s.tableName,"onUpdate:modelValue":e[1]||(e[1]=t=>s.tableName=t),placeholder:"请选择表",style:{width:"100%"},disabled:!s.dataSourceName,filterable:"",onChange:ee},{default:l(()=>[(d(!0),x(O,null,q(P.value,t=>(d(),b(y,{key:t.tableName,label:t.tableName,value:t.tableName},{default:l(()=>[r("div",Me,[r("span",null,_(t.tableName),1),t.remarks?(d(),x("span",je,_(t.remarks),1)):D("",!0)])]),_:2},1032,["label","value"]))),128))]),_:1},8,["modelValue","disabled"])]),_:1})]),_:1}),a(c,{span:8},{default:l(()=>[a(m,{label:"生成类型",prop:"generateTypes"},{default:l(()=>[a(R,{modelValue:s.generateTypes,"onUpdate:modelValue":e[2]||(e[2]=t=>s.generateTypes=t),multiple:"","collapse-tags":"","collapse-tags-tooltip":"",style:{width:"100%"},placeholder:"默认全部"},{default:l(()=>[a(y,{label:"Entity",value:"ENTITY"}),a(y,{label:"Mapper",value:"MAPPER"}),a(y,{label:"XML",value:"XML"}),a(y,{label:"Repository",value:"REPOSITORY"})]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1}),a(T,{gutter:24},{default:l(()=>[a(c,{span:8},{default:l(()=>[a(m,{label:"基础包名",prop:"basePackage"},{default:l(()=>[a(C,{modelValue:s.basePackage,"onUpdate:modelValue":e[3]||(e[3]=t=>s.basePackage=t),placeholder:"com.example.project"},null,8,["modelValue"])]),_:1})]),_:1}),a(c,{span:8},{default:l(()=>[a(m,{label:"作者",prop:"author"},{default:l(()=>[a(C,{modelValue:s.author,"onUpdate:modelValue":e[4]||(e[4]=t=>s.author=t),placeholder:"作者名称"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),a(ue,{modelValue:J.value,"onUpdate:modelValue":e[12]||(e[12]=t=>J.value=t),class:"advanced-config"},{default:l(()=>[a(re,{name:"advanced"},{title:l(()=>[r("div",Re,[a(p,null,{default:l(()=>[a(ne)]),_:1}),e[17]||(e[17]=r("span",null,"高级配置",-1))])]),default:l(()=>[a(T,{gutter:24,style:{"margin-top":"16px"}},{default:l(()=>[a(c,{span:20},{default:l(()=>[r("div",ze,[a(m,{label:"Entity 配置"},{default:l(()=>[a(U,{modelValue:s.overwrite,"onUpdate:modelValue":e[5]||(e[5]=t=>s.overwrite=t)},{default:l(()=>[...e[18]||(e[18]=[u("覆盖已存在文件",-1)])]),_:1},8,["modelValue"]),a(U,{modelValue:s.entity.useLombok,"onUpdate:modelValue":e[6]||(e[6]=t=>s.entity.useLombok=t)},{default:l(()=>[...e[19]||(e[19]=[u("使用 Lombok",-1)])]),_:1},8,["modelValue"]),a(U,{modelValue:s.entity.useJpa,"onUpdate:modelValue":e[7]||(e[7]=t=>s.entity.useJpa=t)},{default:l(()=>[...e[20]||(e[20]=[u("使用 JPA 注解",-1)])]),_:1},8,["modelValue"]),a(U,{modelValue:s.entity.useSwagger,"onUpdate:modelValue":e[8]||(e[8]=t=>s.entity.useSwagger=t)},{default:l(()=>[...e[21]||(e[21]=[u("使用 Swagger 注解",-1)])]),_:1},8,["modelValue"])]),_:1})])]),_:1})]),_:1}),a(T,{gutter:24,style:{"margin-top":"16px"}},{default:l(()=>[a(c,{span:8},{default:l(()=>[a(m,{label:"Entity 父类"},{default:l(()=>[a(C,{modelValue:s.entity.superClass,"onUpdate:modelValue":e[9]||(e[9]=t=>s.entity.superClass=t),placeholder:"可选，如 BaseEntity"},null,8,["modelValue"])]),_:1})]),_:1}),a(c,{span:8},{default:l(()=>[a(m,{label:"Mapper后缀"},{default:l(()=>[a(C,{modelValue:s.mapper.suffix,"onUpdate:modelValue":e[10]||(e[10]=t=>s.mapper.suffix=t),placeholder:"Mapper"},null,8,["modelValue"])]),_:1})]),_:1}),a(c,{span:8},{default:l(()=>[a(m,{label:"XML目录"},{default:l(()=>[a(C,{modelValue:s.xml.directory,"onUpdate:modelValue":e[11]||(e[11]=t=>s.xml.directory=t),placeholder:"mapper"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"]),r("div",Oe,[a(k,{onClick:oe},{default:l(()=>[a(p,null,{default:l(()=>[a(de)]),_:1}),e[22]||(e[22]=u(" 重置 ",-1))]),_:1}),a(k,{type:"primary",onClick:ae,loading:E.value},{default:l(()=>[a(p,null,{default:l(()=>[a(pe)]),_:1}),e[23]||(e[23]=u(" 预览代码 ",-1))]),_:1},8,["loading"]),a(k,{type:"success",onClick:le,loading:M.value},{default:l(()=>[a(p,null,{default:l(()=>[a(ie)]),_:1}),e[24]||(e[24]=u(" 生成并下载 ",-1))]),_:1},8,["loading"])])]),_:1},8,["model"])]),_:1}),v.value.length>0?(d(),b(z,{key:0,shadow:"hover",class:"table-preview-card"},{header:l(()=>[r("div",qe,[r("div",Be,[a(p,null,{default:l(()=>[a(ce)]),_:1}),e[25]||(e[25]=r("span",{class:"header-title"},"表结构预览",-1)),a(V,{size:"small",type:"info"},{default:l(()=>[u(_(s.tableName),1)]),_:1})]),r("span",Je,"共 "+_(v.value.length)+" 个字段",1)])]),default:l(()=>[a(_e,{data:v.value,stripe:"",size:"small","max-height":"300"},{default:l(()=>[a(w,{prop:"columnName",label:"字段名",width:"150"}),a(w,{prop:"dataType",label:"类型",width:"120"},{default:l(({row:t})=>[a(V,{size:"small",type:"info"},{default:l(()=>[u(_(t.dataType),1)]),_:2},1024)]),_:1}),a(w,{prop:"javaType",label:"Java类型",width:"120"}),a(w,{prop:"nullable",label:"可空",width:"80",align:"center"},{default:l(({row:t})=>[a(p,{color:t.nullable?"#67c23a":"#f56c6c"},{default:l(()=>[(d(),b(xe(t.nullable?"Check":"Close")))]),_:2},1032,["color"])]),_:1}),a(w,{prop:"primaryKey",label:"主键",width:"80",align:"center"},{default:l(({row:t})=>[t.primaryKey?(d(),b(V,{key:0,size:"small",type:"warning"},{default:l(()=>[...e[26]||(e[26]=[u("PK",-1)])]),_:1})):D("",!0)]),_:1}),a(w,{prop:"remarks",label:"备注","show-overflow-tooltip":""})]),_:1},8,["data"])]),_:1})):D("",!0),I.value?(d(),b(z,{key:1,shadow:"hover",class:"preview-card"},{header:l(()=>[r("div",Fe,[r("div",Ge,[a(p,null,{default:l(()=>[a(fe)]),_:1}),e[27]||(e[27]=r("span",{class:"header-title"},"代码预览",-1))]),a(ge,{size:"small"},{default:l(()=>[a(k,{onClick:te},{default:l(()=>[a(p,null,{default:l(()=>[a(A)]),_:1}),e[28]||(e[28]=u(" 复制全部 ",-1))]),_:1})]),_:1})])]),default:l(()=>[a(be,{modelValue:S.value,"onUpdate:modelValue":e[13]||(e[13]=t=>S.value=t),type:"border-card",class:"code-tabs"},{default:l(()=>[(d(!0),x(O,null,q(f.value,(t,h)=>(d(),b(ve,{key:h,label:Y(h),name:h},{default:l(()=>[r("div",Ae,[r("div",Ke,[r("span",Xe,_(H(h)),1),a(k,{size:"small",text:"",onClick:Ye=>G(t)},{default:l(()=>[a(p,null,{default:l(()=>[a(A)]),_:1}),e[29]||(e[29]=u(" 复制 ",-1))]),_:1},8,["onClick"])]),r("div",Ie,[r("pre",null,[r("code",{class:Ne(Q(h))},_(t),3)])])])]),_:2},1032,["label","name"]))),128))]),_:1},8,["modelValue"])]),_:1})):D("",!0)])}}},ta=Ce($e,[["__scopeId","data-v-c320aa89"]]);export{ta as default};
