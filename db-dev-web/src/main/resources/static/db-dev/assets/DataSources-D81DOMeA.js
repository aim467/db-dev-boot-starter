import{u as re}from"./datasource-BB4_IJ-g.js";import{t as ue,g as de}from"./datasource-CNDQnR3F.js";import{_ as ce}from"./index-C9u0Vdbf.js";import{b as y,e as pe}from"./element-plus-DuTa5cwT.js";import{r as C,x as _e,V as fe,A as z,B as e,C as t,ay as n,aI as me,o as u,J as j,m as p,u as w,M as d,D as s,K as _,O as i}from"./vue-vendor-BB5k324P.js";import"./request-CcLfhpZL.js";import"./vendor-BTz0EEYM.js";const ye={style:{display:"flex","align-items":"center","justify-content":"space-between"}},ve={style:{display:"flex","align-items":"center",gap:"8px"}},ge={style:{display:"flex",gap:"8px"}},we={style:{display:"flex","align-items":"center",gap:"8px"}},he={style:{display:"flex","align-items":"center","justify-content":"space-between",width:"100%"}},xe={style:{display:"flex","align-items":"center",gap:"8px"}},be={style:{display:"flex","align-items":"center",gap:"8px"}},Ce={class:"stat-value"},ke={class:"stat-value"},Se={class:"stat-value"},ze={style:{display:"flex","align-items":"center",gap:"8px"}},Te={style:{padding:"10px 0"}},De={style:{display:"flex","justify-content":"space-between","margin-top":"12px",color:"#909399","font-size":"12px"}},Le={key:0,style:{color:"#f56c6c"}},Ve={style:{display:"flex","align-items":"center",gap:"8px"}},$e={style:{display:"flex","align-items":"center",gap:"8px"}},Me={__name:"DataSources",setup(Pe){const f=re(),T=C(!1),k=C(null),l=C(null),S=C(!1),$=C(!1);let h=null;const A=a=>({MySQL:"success",PostgreSQL:"warning",Oracle:"danger","SQL Server":"info",H2:""})[a]||"info",M=async()=>{try{await f.loadDataSources(),y.success(`成功加载 ${f.dataSources.length} 个数据源`)}catch(a){y.error("加载数据源失败: "+a.message)}},P=async a=>{try{await ue(a.name),y.success(`数据源 "${a.name}" 连接成功`),a.status="success"}catch{y.error(`数据源 "${a.name}" 连接失败`),a.status="error"}},E=async()=>{const a=pe.service({lock:!0,text:"正在测试所有连接...",background:"rgba(0, 0, 0, 0.7)"});try{await Promise.all(f.dataSources.map(o=>P(o))),y.success("所有连接测试完成")}finally{a.close()}},H=async a=>{k.value=a,T.value=!0,await D()},D=async()=>{if(k.value){S.value=!0;try{const a=await de(k.value.name);l.value=a.data}catch(a){y.error("获取连接池统计失败: "+a.message)}finally{S.value=!1}}},Q=a=>{a?(h=setInterval(D,3e3),y.success("已开启自动刷新 (3秒)")):(h&&(clearInterval(h),h=null),y.info("已关闭自动刷新"))},O=a=>a<50?"#67c23a":a<80?"#e6a23c":"#f56c6c",L=a=>!a||a<=0?"-":a<1e3?`${a}ms`:a<6e4?`${(a/1e3).toFixed(1)}s`:a<36e5?`${(a/6e4).toFixed(1)}min`:`${(a/36e5).toFixed(1)}h`;return _e(()=>{M()}),fe(()=>{h&&clearInterval(h)}),(a,o)=>{const W=n("Connection"),c=n("el-icon"),b=n("el-tag"),I=n("Refresh"),x=n("el-button"),B=n("Link"),J=n("el-empty"),K=n("Star"),v=n("el-table-column"),q=n("el-text"),G=n("CircleCheck"),R=n("DataLine"),X=n("el-button-group"),Y=n("el-table"),g=n("el-card"),Z=n("el-switch"),U=n("el-alert"),V=n("el-col"),ee=n("el-row"),te=n("TrendCharts"),le=n("el-progress"),ae=n("Warning"),oe=n("Setting"),m=n("el-descriptions-item"),F=n("el-descriptions"),ne=n("Histogram"),se=n("el-drawer"),N=me("loading");return u(),z("div",null,[e(g,{shadow:"hover"},{header:t(()=>[s("div",ye,[s("div",ve,[e(c,null,{default:t(()=>[e(W)]),_:1}),o[2]||(o[2]=s("span",{style:{"font-weight":"600"}},"数据源列表",-1)),w(f).dataSources.length>0?(u(),p(b,{key:0,type:"info",size:"small"},{default:t(()=>[d(i(w(f).dataSources.length),1)]),_:1})):_("",!0)]),s("div",ge,[e(x,{type:"primary",size:"small",onClick:M,loading:w(f).loading},{default:t(()=>[e(c,null,{default:t(()=>[e(I)]),_:1}),o[3]||(o[3]=d(" 刷新 ",-1))]),_:1},8,["loading"]),e(x,{type:"success",size:"small",onClick:E},{default:t(()=>[e(c,null,{default:t(()=>[e(B)]),_:1}),o[4]||(o[4]=d(" 测试连接 ",-1))]),_:1})])])]),default:t(()=>[j((u(),z("div",null,[!w(f).loading&&w(f).dataSources.length===0?(u(),p(J,{key:0,description:"未找到数据源"},{default:t(()=>[e(x,{type:"primary",size:"small"},{default:t(()=>[...o[5]||(o[5]=[d("添加数据源",-1)])]),_:1})]),_:1})):(u(),p(Y,{key:1,data:w(f).dataSources,stripe:"",style:{width:"100%"}},{default:t(()=>[e(v,{prop:"name",label:"名称",width:"200",fixed:""},{default:t(r=>[s("div",we,[r.row.primary?(u(),p(c,{key:0,color:"#f56c6c"},{default:t(()=>[e(K)]),_:1})):_("",!0),s("strong",null,i(r.row.name),1)])]),_:1}),e(v,{prop:"databaseType",label:"数据库类型",width:"150"},{default:t(r=>[e(b,{type:A(r.row.databaseType),size:"small"},{default:t(()=>[d(i(r.row.databaseType),1)]),_:2},1032,["type"])]),_:1}),e(v,{prop:"type",label:"连接池类型",width:"180"}),e(v,{prop:"url",label:"URL","min-width":"300","show-overflow-tooltip":""},{default:t(r=>[e(q,{type:"info",size:"small",style:{"font-family":"monospace"}},{default:t(()=>[d(i(r.row.url),1)]),_:2},1024)]),_:1}),e(v,{prop:"username",label:"用户名",width:"120"}),e(v,{label:"状态",width:"140"},{default:t(r=>[e(b,{type:r.row.status||"success",size:"small"},{default:t(()=>[e(c,null,{default:t(()=>[e(G)]),_:1})]),_:1},8,["type"])]),_:1}),e(v,{label:"操作",width:"200",fixed:"right"},{default:t(r=>[e(X,null,{default:t(()=>[e(x,{type:"primary",size:"small",onClick:ie=>H(r.row)},{default:t(()=>[e(c,null,{default:t(()=>[e(R)]),_:1}),o[6]||(o[6]=d(" 监控 ",-1))]),_:1},8,["onClick"]),e(x,{type:"success",size:"small",onClick:ie=>P(r.row)},{default:t(()=>[e(c,null,{default:t(()=>[e(B)]),_:1})]),_:1},8,["onClick"])]),_:2},1024)]),_:1})]),_:1},8,["data"]))])),[[N,w(f).loading]])]),_:1}),e(se,{modelValue:T.value,"onUpdate:modelValue":o[1]||(o[1]=r=>T.value=r),direction:"rtl",size:"550px"},{header:t(()=>[s("div",he,[s("div",xe,[e(c,{color:"#409eff"},{default:t(()=>[e(R)]),_:1}),o[7]||(o[7]=s("span",{style:{"font-weight":"600"}},"连接池监控",-1)),e(b,{type:"info",size:"small"},{default:t(()=>[d(i(k.value?.name),1)]),_:1})]),s("div",be,[e(Z,{modelValue:$.value,"onUpdate:modelValue":o[0]||(o[0]=r=>$.value=r),"active-text":"自动刷新",size:"small",onChange:Q},null,8,["modelValue"]),e(x,{type:"primary",size:"small",onClick:D,loading:S.value},{default:t(()=>[e(c,null,{default:t(()=>[e(I)]),_:1})]),_:1},8,["loading"])])])]),default:t(()=>[j((u(),z("div",null,[l.value?(u(),p(U,{key:0,title:"连接池类型: "+l.value.poolType,type:"info",closable:!1,"show-icon":"",style:{"margin-bottom":"20px"}},null,8,["title"])):_("",!0),l.value&&l.value.activeConnections===-1?(u(),p(U,{key:1,title:"该连接池类型暂不支持详细监控",type:"warning",closable:!1,"show-icon":"",style:{"margin-bottom":"20px"}})):_("",!0),l.value&&l.value.activeConnections!==-1?(u(),p(ee,{key:2,gutter:12},{default:t(()=>[e(V,{span:8},{default:t(()=>[e(g,{shadow:"hover",class:"stat-card stat-card-active"},{default:t(()=>[s("div",Ce,i(l.value.activeConnections),1),o[8]||(o[8]=s("div",{class:"stat-label"},"活跃连接",-1))]),_:1})]),_:1}),e(V,{span:8},{default:t(()=>[e(g,{shadow:"hover",class:"stat-card stat-card-idle"},{default:t(()=>[s("div",ke,i(l.value.idleConnections),1),o[9]||(o[9]=s("div",{class:"stat-label"},"空闲连接",-1))]),_:1})]),_:1}),e(V,{span:8},{default:t(()=>[e(g,{shadow:"hover",class:"stat-card stat-card-total"},{default:t(()=>[s("div",Se,i(l.value.totalConnections),1),o[10]||(o[10]=s("div",{class:"stat-label"},"总连接数",-1))]),_:1})]),_:1})]),_:1})):_("",!0),l.value&&l.value.activeConnections!==-1?(u(),p(g,{key:3,shadow:"hover",style:{"margin-top":"16px"}},{header:t(()=>[s("div",ze,[e(c,null,{default:t(()=>[e(te)]),_:1}),o[11]||(o[11]=s("span",{style:{"font-weight":"600"}},"连接使用率",-1))])]),default:t(()=>[s("div",Te,[e(le,{percentage:l.value.usagePercent,color:O(l.value.usagePercent),"stroke-width":20,format:r=>r.toFixed(1)+"%"},null,8,["percentage","color","format"]),s("div",De,[s("span",null,"活跃: "+i(l.value.activeConnections)+" / 最大: "+i(l.value.maxConnections),1),l.value.waitingThreads>0?(u(),z("span",Le,[e(c,null,{default:t(()=>[e(ae)]),_:1}),d(" "+i(l.value.waitingThreads)+" 个线程等待中 ",1)])):_("",!0)])])]),_:1})):_("",!0),l.value&&l.value.activeConnections!==-1?(u(),p(g,{key:4,shadow:"hover",style:{"margin-top":"16px"}},{header:t(()=>[s("div",Ve,[e(c,null,{default:t(()=>[e(oe)]),_:1}),o[12]||(o[12]=s("span",{style:{"font-weight":"600"}},"连接池配置",-1))])]),default:t(()=>[e(F,{column:2,border:"",size:"small"},{default:t(()=>[e(m,{label:"最大连接数"},{default:t(()=>[d(i(l.value.maxConnections),1)]),_:1}),e(m,{label:"最小空闲"},{default:t(()=>[d(i(l.value.minIdle),1)]),_:1}),l.value.connectionTimeout?(u(),p(m,{key:0,label:"连接超时"},{default:t(()=>[d(i(L(l.value.connectionTimeout)),1)]),_:1})):_("",!0),l.value.idleTimeout?(u(),p(m,{key:1,label:"空闲超时"},{default:t(()=>[d(i(L(l.value.idleTimeout)),1)]),_:1})):_("",!0),l.value.maxLifetime?(u(),p(m,{key:2,label:"最大生命周期"},{default:t(()=>[d(i(L(l.value.maxLifetime)),1)]),_:1})):_("",!0),e(m,{label:"等待线程"},{default:t(()=>[e(b,{type:l.value.waitingThreads>0?"danger":"success",size:"small"},{default:t(()=>[d(i(l.value.waitingThreads),1)]),_:1},8,["type"])]),_:1})]),_:1})]),_:1})):_("",!0),l.value&&l.value.createCount!=null?(u(),p(g,{key:5,shadow:"hover",style:{"margin-top":"16px"}},{header:t(()=>[s("div",$e,[e(c,null,{default:t(()=>[e(ne)]),_:1}),o[13]||(o[13]=s("span",{style:{"font-weight":"600"}},"累计统计",-1))])]),default:t(()=>[e(F,{column:2,border:"",size:"small"},{default:t(()=>[e(m,{label:"累计创建连接"},{default:t(()=>[d(i(l.value.createCount),1)]),_:1}),e(m,{label:"累计销毁连接"},{default:t(()=>[d(i(l.value.destroyCount),1)]),_:1})]),_:1})]),_:1})):_("",!0)])),[[N,S.value]])]),_:1},8,["modelValue"])])}}},Ae=ce(Me,[["__scopeId","data-v-7dc471a9"]]);export{Ae as default};
