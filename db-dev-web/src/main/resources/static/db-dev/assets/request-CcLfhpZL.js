import{P as u}from"./vendor-BTz0EEYM.js";import{r as a}from"./index-C9u0Vdbf.js";import{b as s}from"./element-plus-DuTa5cwT.js";const c=()=>{if(window.__DB_DEV_CONFIG__?.apiBaseURL)return window.__DB_DEV_CONFIG__.apiBaseURL;let e=window.location.pathname;e.endsWith(".html")&&(e=e.substring(0,e.lastIndexOf("/")));const t=document.querySelector('script[src*="assets/"]')?.src;if(t){const o=new URL(t),n=o.pathname.indexOf("/assets/");if(n>0)return o.pathname.substring(0,n)+"/api"}const r=e.split("/").filter(Boolean);return r.length>=2?"/"+r.slice(0,-1).join("/")+"/api":r.length===1?"/"+r[0]+"/api":"/db-dev/api"},i=u.create({baseURL:c(),timeout:3e4});i.interceptors.request.use(e=>{const t=localStorage.getItem("db-dev-token")||sessionStorage.getItem("db-dev-token");return t&&(e.headers.Authorization=`Bearer ${t}`),e},e=>(console.error("Request error:",e),Promise.reject(e)));i.interceptors.response.use(e=>{const t=e.data;return t.code!==200?(s.error(t.message||"Error"),Promise.reject(new Error(t.message||"Error"))):t},e=>{if(console.error("Response error:",e),e.response&&e.response.status===401)return localStorage.removeItem("db-dev-token"),localStorage.removeItem("db-dev-username"),s.error("登录已过期，请重新登录"),a.currentRoute.value.path!=="/login"&&a.push("/login"),Promise.reject(e);const t=e.response?.data?.message||e.message||"请求失败";return s.error(t),Promise.reject(e)});export{i as r};
