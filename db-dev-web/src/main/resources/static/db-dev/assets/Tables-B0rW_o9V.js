import{r as R,u as P}from"./datasource-CGHvgTzV.js";import{_ as j}from"./index-B8Sf_DuM.js";import{a as S,c as G}from"./element-plus-Cxi87m0O.js";import{c as I,m as y,o as p,C as t,B as e,ay as l,D as u,K as E,O as c,M as r,A as U,r as $,x as H,aI as W,P as X,ac as Y,u as Z,J as ee}from"./vue-vendor-yGlHWbnf.js";import"./vendor-BTz0EEYM.js";const te=m=>R({url:"/metadata/tables",method:"get",params:{dataSourceName:m}}),le=(m,b)=>R({url:`/metadata/table/${m}`,method:"get",params:{dataSourceName:b}}),ae={style:{display:"flex","align-items":"center","justify-content":"space-between"}},ne={style:{display:"flex","align-items":"center",gap:"8px"}},oe={style:{"font-weight":"600"}},se={style:{display:"flex",gap:"8px"}},re={style:{display:"flex","align-items":"center",gap:"4px"}},ie={style:{display:"flex","align-items":"center",gap:"6px"}},ue={key:1},ce={style:{display:"flex","align-items":"center",gap:"4px"}},de={style:{display:"flex","align-items":"center",gap:"4px"}},pe={style:{display:"flex","align-items":"center","justify-content":"space-between"}},me={__name:"TableDetail",props:{table:{type:Object,required:!0}},emits:["close"],setup(m){const b=m,v=I(()=>{if(!b.table||!b.table.columns)return"";const g=b.table.tableName,a=b.table.columns.map(d=>{let s=`  \`${d.columnName}\` ${d.typeName}`;return d.columnSize>0&&(s+=`(${d.columnSize})`),d.nullable||(s+=" NOT NULL"),d.autoIncrement&&(s+=" AUTO_INCREMENT"),d.columnDef&&(s+=` DEFAULT '${d.columnDef}'`),d.remarks&&(s+=` COMMENT '${d.remarks}'`),s}).join(`,
`);return`CREATE TABLE \`${g}\` (
${a}
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='${b.table.remarks||""}';`}),h=()=>{const g=JSON.stringify(b.table,null,2),a=new Blob([g],{type:"application/json"}),d=URL.createObjectURL(a),s=document.createElement("a");s.href=d,s.download=`${b.table.tableName}.json`,s.click(),URL.revokeObjectURL(d),S.success("导出成功")},x=()=>{navigator.clipboard.writeText(v.value).then(()=>{S.success("SQL已复制到剪贴板")}).catch(()=>{S.error("复制失败")})};return(g,a)=>{const d=l("Document"),s=l("el-icon"),T=l("el-tag"),V=l("Download"),_=l("el-button"),i=l("Close"),k=l("List"),w=l("Key"),f=l("el-table-column"),C=l("el-table"),N=l("el-tab-pane"),A=l("el-empty"),D=l("DocumentCopy"),M=l("el-input"),z=l("el-card"),O=l("el-tabs");return p(),y(z,{shadow:"hover"},{header:t(()=>[u("div",ae,[u("div",ne,[e(s,null,{default:t(()=>[e(d)]),_:1}),u("span",oe,"表详情: "+c(m.table.tableName),1),e(T,{type:"info",size:"small"},{default:t(()=>[r(c(m.table.tableType),1)]),_:1})]),u("div",se,[e(_,{type:"primary",size:"small",onClick:h},{default:t(()=>[e(s,null,{default:t(()=>[e(V)]),_:1}),a[1]||(a[1]=r(" 导出 ",-1))]),_:1}),e(_,{size:"small",onClick:a[0]||(a[0]=n=>g.$emit("close"))},{default:t(()=>[e(s,null,{default:t(()=>[e(i)]),_:1}),a[2]||(a[2]=r(" 关闭 ",-1))]),_:1})])])]),default:t(()=>[e(O,{type:"border-card"},{default:t(()=>[e(N,null,{label:t(()=>[u("span",re,[e(s,null,{default:t(()=>[e(k)]),_:1}),r(" 字段信息 ("+c(m.table.columns?.length||0)+") ",1)])]),default:t(()=>[e(C,{data:m.table.columns,stripe:"",border:"",style:{width:"100%"},height:"400"},{default:t(()=>[e(f,{prop:"columnName",label:"字段名",width:"180",fixed:""},{default:t(n=>[u("div",ie,[n.row.primaryKey?(p(),y(s,{key:0,color:"#f56c6c",size:"14"},{default:t(()=>[e(w)]),_:1})):E("",!0),u("strong",null,c(n.row.columnName),1)])]),_:1}),e(f,{prop:"typeName",label:"类型",width:"120",sortable:""}),e(f,{prop:"columnSize",label:"大小",width:"80",sortable:""},{default:t(n=>[r(c(n.row.columnSize>0?n.row.columnSize:"-"),1)]),_:1}),e(f,{label:"可空",width:"80",sortable:""},{default:t(n=>[e(T,{type:n.row.nullable?"info":"warning",size:"small"},{default:t(()=>[r(c(n.row.nullable?"是":"否"),1)]),_:2},1032,["type"])]),_:1}),e(f,{prop:"columnDef",label:"默认值",width:"120"},{default:t(n=>[r(c(n.row.columnDef||"-"),1)]),_:1}),e(f,{prop:"remarks",label:"备注","min-width":"200","show-overflow-tooltip":""},{default:t(n=>[r(c(n.row.remarks||"-"),1)]),_:1}),e(f,{label:"自增",width:"80"},{default:t(n=>[n.row.autoIncrement?(p(),y(T,{key:0,type:"success",size:"small"},{default:t(()=>[...a[3]||(a[3]=[r("是",-1)])]),_:1})):(p(),U("span",ue,"-"))]),_:1})]),_:1},8,["data"])]),_:1}),e(N,null,{label:t(()=>[u("span",ce,[e(s,null,{default:t(()=>[e(w)]),_:1}),r(" 索引信息 ("+c(m.table.indexes?.length||0)+") ",1)])]),default:t(()=>[!m.table.indexes||m.table.indexes.length===0?(p(),y(A,{key:0,description:"无索引信息"})):(p(),y(C,{key:1,data:m.table.indexes,stripe:"",border:"",style:{width:"100%"}},{default:t(()=>[e(f,{prop:"indexName",label:"索引名",width:"200"}),e(f,{prop:"columnName",label:"列名",width:"180"}),e(f,{label:"唯一",width:"100"},{default:t(n=>[e(T,{type:n.row.nonUnique?"info":"success",size:"small"},{default:t(()=>[r(c(n.row.nonUnique?"否":"是"),1)]),_:2},1032,["type"])]),_:1}),e(f,{prop:"type",label:"类型","min-width":"150"},{default:t(n=>[r(c(n.row.type||"-"),1)]),_:1}),e(f,{label:"排序",width:"100"},{default:t(n=>[r(c(n.row.ascOrDesc||"ASC"),1)]),_:1})]),_:1},8,["data"]))]),_:1}),e(N,null,{label:t(()=>[u("span",de,[e(s,null,{default:t(()=>[e(D)]),_:1}),a[4]||(a[4]=r(" SQL预览 ",-1))])]),default:t(()=>[e(z,{shadow:"never"},{header:t(()=>[u("div",pe,[a[6]||(a[6]=u("span",null,"CREATE TABLE 语句",-1)),e(_,{type:"primary",size:"small",onClick:x},{default:t(()=>[e(s,null,{default:t(()=>[e(D)]),_:1}),a[5]||(a[5]=r(" 复制 ",-1))]),_:1})])]),default:t(()=>[e(M,{type:"textarea",rows:15,"model-value":v.value,readonly:"",style:{"font-family":"'Courier New', monospace"}},null,8,["model-value"])]),_:1})]),_:1})]),_:1})]),_:1})}}},_e=j(me,[["__scopeId","data-v-cff6dcc5"]]),fe={style:{display:"flex","align-items":"center",gap:"8px"}},be={style:{display:"flex","align-items":"center",gap:"8px"}},ye={style:{display:"flex","align-items":"center","justify-content":"space-between"}},ge={style:{display:"flex","align-items":"center",gap:"8px"}},we={style:{display:"flex",gap:"8px"}},ve={style:{display:"flex","align-items":"center",gap:"8px"}},he={__name:"Tables",setup(m){const b=P(),v=$(""),h=$([]),x=$(""),g=$(!1),a=$(null),d=_=>({MySQL:"success",PostgreSQL:"warning",Oracle:"danger","SQL Server":"info"})[_]||"info",s=I(()=>{if(!x.value)return h.value;const _=x.value.toLowerCase();return h.value.filter(i=>i.tableName.toLowerCase().includes(_))}),T=async()=>{if(v.value){g.value=!0,a.value=null,x.value="";try{const _=await te(v.value);h.value=_.data,S.success(`成功加载 ${h.value.length} 个表`)}catch(_){S.error("加载表列表失败: "+_.message)}finally{g.value=!1}}},V=async _=>{const i=G.service({lock:!0,text:"正在加载表详情...",background:"rgba(0, 0, 0, 0.7)"});try{const k=await le(_,v.value);a.value=k.data,S.success("加载表详情成功")}catch(k){S.error("加载表详情失败: "+k.message)}finally{i.close()}};return H(async()=>{b.dataSources.length===0&&await b.loadDataSources()}),(_,i)=>{const k=l("Setting"),w=l("el-icon"),f=l("Star"),C=l("el-tag"),N=l("el-option"),A=l("el-select"),D=l("el-card"),M=l("Folder"),z=l("Search"),O=l("el-input"),n=l("Refresh"),B=l("el-button"),q=l("el-empty"),F=l("Document"),L=l("el-table-column"),Q=l("View"),K=l("el-table"),J=W("loading");return p(),U("div",null,[e(D,{shadow:"hover",style:{"margin-bottom":"20px"}},{header:t(()=>[u("div",fe,[e(w,null,{default:t(()=>[e(k)]),_:1}),i[3]||(i[3]=u("span",{style:{"font-weight":"600"}},"数据源选择",-1))])]),default:t(()=>[e(A,{modelValue:v.value,"onUpdate:modelValue":i[0]||(i[0]=o=>v.value=o),placeholder:"请选择数据源",style:{width:"300px"},onChange:T,clearable:""},{default:t(()=>[(p(!0),U(X,null,Y(Z(b).dataSources,o=>(p(),y(N,{key:o.name,label:o.name,value:o.name},{default:t(()=>[u("div",be,[o.primary?(p(),y(w,{key:0,color:"#f56c6c"},{default:t(()=>[e(f)]),_:1})):E("",!0),u("span",null,c(o.name),1),e(C,{size:"small",type:d(o.databaseType)},{default:t(()=>[r(c(o.databaseType),1)]),_:2},1032,["type"])])]),_:2},1032,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),v.value?(p(),y(D,{key:0,shadow:"hover",style:{"margin-bottom":"20px"}},{header:t(()=>[u("div",ye,[u("div",ge,[e(w,null,{default:t(()=>[e(M)]),_:1}),i[4]||(i[4]=u("span",{style:{"font-weight":"600"}},"表列表",-1)),h.value.length>0?(p(),y(C,{key:0,type:"info",size:"small"},{default:t(()=>[r(c(h.value.length),1)]),_:1})):E("",!0)]),u("div",we,[e(O,{modelValue:x.value,"onUpdate:modelValue":i[1]||(i[1]=o=>x.value=o),placeholder:"搜索表名",style:{width:"200px"},clearable:""},{prefix:t(()=>[e(w,null,{default:t(()=>[e(z)]),_:1})]),_:1},8,["modelValue"]),e(B,{type:"primary",size:"small",onClick:T,loading:g.value},{default:t(()=>[e(w,null,{default:t(()=>[e(n)]),_:1}),i[5]||(i[5]=r(" 刷新 ",-1))]),_:1},8,["loading"])])])]),default:t(()=>[ee((p(),U("div",null,[!g.value&&s.value.length===0?(p(),y(q,{key:0,description:"未找到表"})):(p(),y(K,{key:1,data:s.value,stripe:"",style:{width:"100%"},height:"400"},{default:t(()=>[e(L,{prop:"tableName",label:"表名","min-width":"200",sortable:""},{default:t(o=>[u("div",ve,[e(w,{color:"#409eff"},{default:t(()=>[e(F)]),_:1}),u("strong",null,c(o.row.tableName),1)])]),_:1}),e(L,{prop:"tableType",label:"类型",width:"120",sortable:""},{default:t(o=>[e(C,{type:o.row.tableType==="TABLE"?"success":"info",size:"small"},{default:t(()=>[r(c(o.row.tableType),1)]),_:2},1032,["type"])]),_:1}),e(L,{prop:"remarks",label:"备注","min-width":"200","show-overflow-tooltip":""},{default:t(o=>[r(c(o.row.remarks||"-"),1)]),_:1}),e(L,{prop:"columnCount",label:"字段数",width:"100",sortable:""},{default:t(o=>[e(C,{size:"small"},{default:t(()=>[r(c(o.row.columnCount||0),1)]),_:2},1024)]),_:1}),e(L,{label:"操作",width:"150",fixed:"right"},{default:t(o=>[e(B,{type:"primary",size:"small",onClick:xe=>V(o.row.tableName)},{default:t(()=>[e(w,null,{default:t(()=>[e(Q)]),_:1}),i[6]||(i[6]=r(" 详情 ",-1))]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"]))])),[[J,g.value]])]),_:1})):E("",!0),a.value?(p(),y(_e,{key:1,table:a.value,onClose:i[2]||(i[2]=o=>a.value=null)},null,8,["table"])):E("",!0)])}}},De=j(he,[["__scopeId","data-v-49338ebf"]]);export{De as default};
