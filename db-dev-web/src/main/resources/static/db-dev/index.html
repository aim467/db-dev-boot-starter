<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DB Dev - Database Development Assistant</title>
    
    <!-- 使用更现代的CDN和版本 -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/element-plus@2.8.2/dist/index.css">
    <script src="https://cdn.jsdelivr.net/npm/vue@3.4.26/dist/vue.global.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/element-plus@2.8.2/dist/index.full.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@element-plus/icons-vue@2.3.1/dist/index.iife.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/axios@1.6.8/dist/axios.min.js"></script>
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        html, body {
            height: 100%;
            overflow: hidden;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'PingFang SC', 'Hiragino Sans GB', 'Microsoft YaHei', sans-serif;
        }

        #app {
            height: 100%;
        }

        .app-container {
            height: 100%;
        }

        .el-aside {
            background: linear-gradient(180deg, #1a1f2e 0%, #0f1419 100%);
            color: #fff;
            box-shadow: 4px 0 20px rgba(0, 0, 0, 0.15);
            position: relative;
            overflow: hidden;
        }

        .el-aside::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: radial-gradient(circle at 20% 50%, rgba(64, 158, 255, 0.05) 0%, transparent 50%);
            pointer-events: none;
        }

        .sidebar-header {
            padding: 24px 20px;
            background: linear-gradient(135deg, rgba(64, 158, 255, 0.1) 0%, rgba(103, 194, 58, 0.05) 100%);
            border-bottom: 1px solid rgba(255, 255, 255, 0.08);
            position: relative;
            z-index: 1;
        }

        .sidebar-header h1 {
            font-size: 22px;
            font-weight: 700;
            color: #fff;
            display: flex;
            align-items: center;
            gap: 10px;
            letter-spacing: 0.5px;
        }

        .sidebar-header h1 .el-icon {
            font-size: 28px;
            color: #409eff;
            filter: drop-shadow(0 0 8px rgba(64, 158, 255, 0.5));
        }

        .sidebar-header p {
            font-size: 11px;
            color: rgba(255, 255, 255, 0.5);
            margin-top: 6px;
            letter-spacing: 1px;
            text-transform: uppercase;
        }

        .el-menu {
            border-right: none;
            background-color: transparent;
            padding: 12px 0;
        }

        .el-menu-item {
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            margin: 6px 12px;
            border-radius: 10px;
            height: 48px;
            line-height: 48px;
            font-size: 14px;
            font-weight: 500;
            position: relative;
            overflow: hidden;
        }

        .el-menu-item::before {
            content: '';
            position: absolute;
            left: 0;
            top: 50%;
            transform: translateY(-50%);
            width: 3px;
            height: 0;
            background: linear-gradient(180deg, #409eff 0%, #67c23a 100%);
            border-radius: 0 3px 3px 0;
            transition: height 0.3s ease;
        }

        .el-menu-item:hover {
            background: linear-gradient(90deg, rgba(64, 158, 255, 0.15) 0%, rgba(64, 158, 255, 0.05) 100%) !important;
            transform: translateX(4px);
        }

        .el-menu-item:hover::before {
            height: 24px;
        }

        .el-menu-item.is-active {
            background: linear-gradient(90deg, rgba(64, 158, 255, 0.25) 0%, rgba(64, 158, 255, 0.1) 100%) !important;
            color: #409eff !important;
            box-shadow: 0 4px 12px rgba(64, 158, 255, 0.2);
        }

        .el-menu-item.is-active::before {
            height: 32px;
        }

        .el-menu-item .el-icon {
            font-size: 18px;
            margin-right: 12px;
        }

        .content-body {
            padding: 24px;
            height: calc(100vh - 60px);
            overflow-y: auto;
            background: #f5f7fa;
            position: relative;
        }

        .content-body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 240px;
            right: 0;
            height: 300px;
            background: linear-gradient(135deg, rgba(64, 158, 255, 0.03) 0%, rgba(103, 194, 58, 0.02) 100%);
            pointer-events: none;
            z-index: 0;
        }

        .welcome-card {
            margin-bottom: 24px;
            border: none;
            border-radius: 16px;
            /*background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);*/
            background-color: #3b98ff !important;
            color: white;
            overflow: hidden;
            position: relative;
            box-shadow: 0 8px 32px rgba(102, 126, 234, 0.3);
        }

        .welcome-card::before {
            content: '';
            position: absolute;
            top: -50%;
            right: -20%;
            width: 400px;
            height: 400px;
            background: radial-gradient(circle, rgba(255, 255, 255, 0.1) 0%, transparent 70%);
            border-radius: 50%;
        }

        .welcome-card .el-card__header {
            background: rgba(255, 255, 255, 0.15);
            border-bottom: 1px solid rgba(255, 255, 255, 0.2);
            color: white;
            backdrop-filter: blur(10px);
        }

        .welcome-card .el-card__header span {
            color: #fff !important;
        }

        .welcome-card .el-card__body {
            position: relative;
            z-index: 1;
        }

        .feature-list {
            margin-top: 16px;
            line-height: 2.2;
            list-style: none;
        }

        .feature-list li {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 12px 16px;
            transition: all 0.3s ease;
            border-radius: 10px;
            background: rgba(255, 255, 255, 0.1);
            margin-bottom: 10px;
            color: #fff;
            font-size: 14px;
            font-weight: 500;
            backdrop-filter: blur(5px);
        }

        .feature-list li:hover {
            transform: translateX(8px);
            background: rgba(255, 255, 255, 0.2);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
        }

        .feature-list li .el-icon {
            font-size: 22px;
            filter: drop-shadow(0 2px 4px rgba(0, 0, 0, 0.3));
            flex-shrink: 0;
        }

        .feature-list li span {
            color: #fff;
        }

        .el-card {
            border: none;
            border-radius: 16px;
            box-shadow: 0 2px 16px rgba(0, 0, 0, 0.06);
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            background: #fff;
            position: relative;
            z-index: 1;
        }

        .el-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            border-radius: 16px;
            padding: 2px;
            background: linear-gradient(135deg, rgba(64, 158, 255, 0.1), rgba(103, 194, 58, 0.1));
            -webkit-mask: linear-gradient(#fff 0 0) content-box, linear-gradient(#fff 0 0);
            -webkit-mask-composite: xor;
            mask-composite: exclude;
            opacity: 0;
            transition: opacity 0.4s ease;
        }

        .el-card:hover {
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.12);
            transform: translateY(-4px);
        }

        .el-card:hover::before {
            opacity: 1;
        }

        .section-title {
            font-size: 18px;
            font-weight: 700;
            margin-bottom: 16px;
            color: #303133;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .section-title::before {
            content: '';
            width: 4px;
            height: 20px;
            background: linear-gradient(180deg, #409eff 0%, #67c23a 100%);
            border-radius: 2px;
        }

        /* 表格优化 */
        .el-table {
            border-radius: 12px;
            overflow: hidden;
            box-shadow: 0 2px 12px rgba(0, 0, 0, 0.04);
        }

        .el-table .el-table__header-wrapper th {
            background: linear-gradient(135deg, #f8f9fa 0%, #f0f2f5 100%);
            font-weight: 700;
            color: #303133;
            font-size: 13px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            border-bottom: 2px solid #e4e7ed;
        }

        .el-table .el-table__row {
            transition: all 0.3s ease;
        }

        .el-table .el-table__row:hover {
            background: linear-gradient(90deg, rgba(64, 158, 255, 0.03) 0%, rgba(103, 194, 58, 0.02) 100%) !important;
        }

        /* 按钮优化 */
        .el-button {
            border-radius: 8px;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            font-weight: 500;
            letter-spacing: 0.3px;
        }

        .el-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(64, 158, 255, 0.25);
        }

        .el-button:active {
            transform: translateY(0);
        }

        .el-button--primary {
            background: linear-gradient(135deg, #409eff 0%, #3a8ee6 100%);
            border: none;
        }

        .el-button--success {
            background: linear-gradient(135deg, #67c23a 0%, #5daf34 100%);
            border: none;
        }

        .el-button--warning {
            background: linear-gradient(135deg, #e6a23c 0%, #cf9236 100%);
            border: none;
        }

        .el-button--danger {
            background: linear-gradient(135deg, #f56c6c 0%, #dd6161 100%);
            border: none;
        }

        /* 标签优化 */
        .el-tag {
            border-radius: 16px;
            font-weight: 600;
            padding: 4px 12px;
            border: none;
            font-size: 12px;
            letter-spacing: 0.3px;
        }

        /* 输入框优化 */
        .el-input__wrapper {
            border-radius: 10px;
            transition: all 0.3s ease;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.04);
        }

        .el-input__wrapper:hover {
            box-shadow: 0 2px 12px rgba(0, 0, 0, 0.08);
        }

        .el-input__wrapper.is-focus {
            box-shadow: 0 0 0 3px rgba(64, 158, 255, 0.15);
        }

        .el-select .el-input__wrapper {
            border-radius: 10px;
        }

        /* 加载动画优化 */
        .el-loading-mask {
            border-radius: 12px;
        }

        /* 空状态优化 */
        .el-empty {
            padding: 40px 0;
        }

        .el-empty__description {
            color: #909399;
            font-size: 14px;
        }

        /* 头部优化 */
        .el-header {
            background: #fff;
            border-bottom: 1px solid rgba(0, 0, 0, 0.06);
            display: flex;
            align-items: center;
            padding: 0 32px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.04);
            position: relative;
            z-index: 10;
        }

        .el-header::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            height: 2px;
            background: linear-gradient(90deg, #409eff 0%, #67c23a 100%);
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .el-header:hover::after {
            opacity: 0.3;
        }

        .el-header h2 {
            font-size: 22px;
            font-weight: 700;
            color: #303133;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            letter-spacing: 0.5px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .el-header h2::before {
            content: '';
            width: 4px;
            height: 24px;
            background: linear-gradient(180deg, #409eff 0%, #67c23a 100%);
            border-radius: 2px;
        }

        /* 响应式优化 */
        @media (max-width: 768px) {
            .el-aside {
                width: 200px !important;
            }
            
            .content-body {
                padding: 15px;
            }
            
            .el-header {
                padding: 0 15px;
            }
        }

        /* 滚动条优化 */
        ::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }

        ::-webkit-scrollbar-track {
            background: rgba(0, 0, 0, 0.02);
            border-radius: 4px;
        }

        ::-webkit-scrollbar-thumb {
            background: linear-gradient(180deg, rgba(64, 158, 255, 0.3) 0%, rgba(103, 194, 58, 0.3) 100%);
            border-radius: 4px;
            transition: background 0.3s ease;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: linear-gradient(180deg, rgba(64, 158, 255, 0.5) 0%, rgba(103, 194, 58, 0.5) 100%);
        }

        /* 卡片标题图标动画 */
        .el-icon {
            transition: transform 0.3s ease;
        }

        .el-card:hover .el-icon {
            transform: scale(1.1);
        }

        /* 状态徽章 */
        .status-badge {
            display: inline-flex;
            align-items: center;
            gap: 6px;
            padding: 6px 12px;
            border-radius: 16px;
            font-size: 12px;
            font-weight: 600;
            letter-spacing: 0.3px;
        }

        .status-badge.success {
            background: linear-gradient(135deg, #f0f9ff 0%, #e0f2fe 100%);
            color: #0ea5e9;
            box-shadow: 0 2px 8px rgba(14, 165, 233, 0.15);
        }

        .status-badge.warning {
            background: linear-gradient(135deg, #fef3c7 0%, #fde68a 100%);
            color: #f59e0b;
            box-shadow: 0 2px 8px rgba(245, 158, 11, 0.15);
        }

        .status-badge.error {
            background: linear-gradient(135deg, #fee2e2 0%, #fecaca 100%);
            color: #ef4444;
            box-shadow: 0 2px 8px rgba(239, 68, 68, 0.15);
        }

        /* 动画效果 */
        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .el-card {
            animation: fadeInUp 0.5s ease-out;
        }

        /* 加载状态优化 */
        .el-loading-spinner .circular {
            width: 42px;
            height: 42px;
        }

        .el-loading-spinner .path {
            stroke: #409eff;
            stroke-width: 3;
        }

        /* Tabs优化 */
        .el-tabs--border-card {
            border-radius: 12px;
            box-shadow: 0 2px 12px rgba(0, 0, 0, 0.04);
            border: none;
        }

        .el-tabs__header {
            background: linear-gradient(135deg, #f8f9fa 0%, #f0f2f5 100%);
            border-radius: 12px 12px 0 0;
        }

        .el-tabs__item {
            font-weight: 600;
            transition: all 0.3s ease;
        }

        .el-tabs__item.is-active {
            color: #409eff;
        }

        /* Alert优化 */
        .el-alert {
            border-radius: 12px;
            border: none;
            box-shadow: 0 2px 12px rgba(0, 0, 0, 0.06);
        }

        /* Empty状态优化 */
        .el-empty {
            padding: 60px 0;
        }

        .el-empty__image {
            width: 120px;
        }

        .el-empty__description {
            color: #909399;
            font-size: 14px;
            margin-top: 16px;
        }

        /* NULL值样式 */
        .null-value {
            color: #909399;
            font-style: italic;
            opacity: 0.7;
        }

        /* 对话框优化 */
        .el-dialog {
            border-radius: 12px;
        }

        .el-dialog__header {
            background: linear-gradient(135deg, #f8f9fa 0%, #f0f2f5 100%);
            border-radius: 12px 12px 0 0;
            padding: 20px;
        }

        .el-dialog__title {
            font-weight: 700;
            color: #303133;
        }

        .el-dialog__body {
            padding: 20px;
        }
    </style>
</head>
<body>
<div id="app">
    <el-container class="app-container">
        <!-- 侧边栏 -->
        <el-aside width="240px">
            <div class="sidebar-header">
                <h1>
                    <el-icon><Database /></el-icon>
                    DB Dev
                </h1>
                <p>Database Development Assistant</p>
            </div>
            <el-menu
                :default-active="currentView"
                background-color="transparent"
                text-color="#bfcbd9"
                active-text-color="#409eff"
                @select="handleMenuSelect">
                <el-menu-item v-for="item in menuItems" :key="item.key" :index="item.key">
                    <el-icon><component :is="item.icon" /></el-icon>
                    <span>{{ item.label }}</span>
                </el-menu-item>
            </el-menu>
        </el-aside>

        <!-- 主内容区 -->
        <el-container>
            <el-header height="60px">
                <h2>{{ currentViewTitle }}</h2>
                <div style="margin-left: auto; display: flex; align-items: center; gap: 10px;">
                    <el-tooltip content="刷新页面" placement="bottom">
                        <el-button circle size="small" @click="refreshCurrentView">
                            <el-icon><Refresh /></el-icon>
                        </el-button>
                    </el-tooltip>
                    <el-tooltip content="系统设置" placement="bottom">
                        <el-button circle size="small">
                            <el-icon><Setting /></el-icon>
                        </el-button>
                    </el-tooltip>
                </div>
            </el-header>
            <el-main class="content-body">
                <!-- Dashboard -->
                <div v-if="currentView === 'dashboard'">
                    <el-card class="welcome-card" shadow="hover">
                        <template #header>
                            <div style="display: flex; align-items: center; gap: 8px;">
                                <el-icon color="#fff"><Promotion /></el-icon>
                                <span style="font-weight: 600; color: #fff;">欢迎使用 DB Dev</span>
                            </div>
                        </template>
                        <p style="margin-bottom: 15px; color: #fff; font-size: 14px; line-height: 1.6;">这是一个面向开发者的数据库开发辅助工具，提供以下功能：</p>
                        <ul class="feature-list">
                            <li style="color: #fff;"><el-icon color="#67c23a"><Connection /></el-icon> <span>数据源管理与监控</span></li>
                            <li style="color: #fff;"><el-icon color="#409eff"><Folder /></el-icon> <span>数据库元数据浏览</span></li>
                            <li style="color: #fff;"><el-icon color="#e6a23c"><Lightning /></el-icon> <span>SQL 执行与调试</span></li>
                            <li style="color: #fff;"><el-icon color="#f56c6c"><Tools /></el-icon> <span>代码生成工具（即将推出）</span></li>
                        </ul>
                    </el-card>
                    
                    <el-row :gutter="20">
                        <el-col :span="12">
                            <el-card shadow="hover">
                                <template #header>
                                    <div style="display: flex; align-items: center; gap: 8px;">
                                        <el-icon color="#67c23a"><Guide /></el-icon>
                                        <span style="font-weight: 600;">快速开始</span>
                                    </div>
                                </template>
                                <el-alert
                                    title="点击左侧菜单开始探索您的数据库"
                                    type="info"
                                    :closable="false"
                                    show-icon>
                                </el-alert>
                            </el-card>
                        </el-col>
                        <el-col :span="12">
                            <el-card shadow="hover">
                                <template #header>
                                    <div style="display: flex; align-items: center; gap: 8px;">
                                        <el-icon color="#409eff"><InfoFilled /></el-icon>
                                        <span style="font-weight: 600;">系统信息</span>
                                    </div>
                                </template>
                                <div style="line-height: 2;">
                                    <p><el-icon size="14"><Clock /></el-icon> 版本: 1.0.0</p>
                                    <p><el-icon size="14"><User /></el-icon> 用户: Developer</p>
                                </div>
                            </el-card>
                        </el-col>
                    </el-row>
                </div>

                <!-- 数据源列表 -->
                <div v-if="currentView === 'datasources'">
                    <el-card shadow="hover">
                        <template #header>
                            <div style="display: flex; align-items: center; justify-content: space-between;">
                                <div style="display: flex; align-items: center; gap: 8px;">
                                    <el-icon><Connection /></el-icon>
                                    <span style="font-weight: 600;">数据源列表</span>
                                    <el-tag v-if="dataSources.length > 0" type="info" size="small">{{ dataSources.length }}</el-tag>
                                </div>
                                <div style="display: flex; gap: 8px;">
                                    <el-button type="primary" size="small" @click="loadDataSources" :loading="loading">
                                        <el-icon><Refresh /></el-icon>
                                        刷新
                                    </el-button>
                                    <el-button type="success" size="small" @click="testAllConnections">
                                        <el-icon><Link /></el-icon>
                                        测试连接
                                    </el-button>
                                </div>
                            </div>
                        </template>
                        <div v-loading="loading">
                            <el-empty v-if="!loading && dataSources.length === 0" description="未找到数据源" image="/api/empty-state">
                                <el-button type="primary" size="small">添加数据源</el-button>
                            </el-empty>
                            <el-table v-else :data="dataSources" stripe style="width: 100%" height="500">
                                <el-table-column prop="name" label="名称" width="200" fixed>
                                    <template #default="scope">
                                        <div style="display: flex; align-items: center; gap: 8px;">
                                            <el-icon v-if="scope.row.primary" color="#f56c6c"><Star /></el-icon>
                                            <strong>{{ scope.row.name }}</strong>
                                        </div>
                                    </template>
                                </el-table-column>
                                <el-table-column prop="databaseType" label="数据库类型" width="150">
                                    <template #default="scope">
                                        <el-tag :type="getDatabaseTypeColor(scope.row.databaseType)" size="small">
                                            {{ scope.row.databaseType }}
                                        </el-tag>
                                    </template>
                                </el-table-column>
                                <el-table-column prop="type" label="连接池类型" width="180">
                                </el-table-column>
                                <el-table-column prop="url" label="URL" min-width="300" show-overflow-tooltip>
                                    <template #default="scope">
                                        <el-text type="info" size="small" style="font-family: monospace;">{{ scope.row.url }}</el-text>
                                    </template>
                                </el-table-column>
                                <el-table-column prop="username" label="用户名" width="120">
                                </el-table-column>
                                <el-table-column label="状态" width="120">
                                    <template #default="scope">
                                        <el-tag :type="scope.row.status || 'success'" size="small">
                                            <el-icon><CircleCheck /></el-icon>
                                            {{ scope.row.status === 'error' ? '连接失败' : '已连接' }}
                                        </el-tag>
                                    </template>
                                </el-table-column>
                                <el-table-column label="操作" width="150" fixed="right">
                                    <template #default="scope">
                                        <el-button-group>
                                            <el-button type="primary" size="small" @click="testConnection(scope.row)">
                                                <el-icon><Link /></el-icon>
                                            </el-button>
                                            <el-button type="warning" size="small" @click="editDataSource(scope.row)">
                                                <el-icon><Edit /></el-icon>
                                            </el-button>
                                            <el-button type="danger" size="small" @click="deleteDataSource(scope.row)">
                                                <el-icon><Delete /></el-icon>
                                            </el-button>
                                        </el-button-group>
                                    </template>
                                </el-table-column>
                            </el-table>
                        </div>
                    </el-card>
                </div>

                <!-- 表结构浏览 -->
                <div v-if="currentView === 'tables'">
                    <el-card shadow="hover" style="margin-bottom: 20px;">
                        <template #header>
                            <div style="display: flex; align-items: center; gap: 8px;">
                                <el-icon><Setting /></el-icon>
                                <span style="font-weight: 600;">数据源选择</span>
                            </div>
                        </template>
                        <el-select
                            v-model="selectedDataSource"
                            placeholder="请选择数据源"
                            style="width: 300px;"
                            @change="loadTables"
                            clearable>
                            <el-option
                                v-for="ds in dataSources"
                                :key="ds.name"
                                :label="ds.name"
                                :value="ds.name">
                                <div style="display: flex; align-items: center; gap: 8px;">
                                    <el-icon v-if="ds.primary" color="#f56c6c"><Star /></el-icon>
                                    <span>{{ ds.name }}</span>
                                    <el-tag size="small" :type="getDatabaseTypeColor(ds.databaseType)">{{ ds.databaseType }}</el-tag>
                                </div>
                            </el-option>
                        </el-select>
                    </el-card>

                    <el-card v-if="selectedDataSource" shadow="hover" style="margin-bottom: 20px;">
                        <template #header>
                            <div style="display: flex; align-items: center; justify-content: space-between;">
                                <div style="display: flex; align-items: center; gap: 8px;">
                                    <el-icon><Folder /></el-icon>
                                    <span style="font-weight: 600;">表列表</span>
                                    <el-tag v-if="tables.length > 0" type="info" size="small">{{ tables.length }}</el-tag>
                                </div>
                                <div style="display: flex; gap: 8px;">
                                    <el-input
                                        v-model="tableSearch"
                                        placeholder="搜索表名"
                                        style="width: 200px;"
                                        clearable>
                                        <template #prefix>
                                            <el-icon><Search /></el-icon>
                                        </template>
                                    </el-input>
                                    <el-button type="primary" size="small" @click="loadTables" :loading="loadingTables">
                                        <el-icon><Refresh /></el-icon>
                                        刷新
                                    </el-button>
                                </div>
                            </div>
                        </template>
                        <div v-loading="loadingTables">
                            <el-empty v-if="!loadingTables && filteredTables.length === 0" description="未找到表"></el-empty>
                            <el-table v-else :data="filteredTables" stripe style="width: 100%" height="400">
                                <el-table-column prop="tableName" label="表名" min-width="200" sortable>
                                    <template #default="scope">
                                        <div style="display: flex; align-items: center; gap: 8px;">
                                            <el-icon color="#409eff"><Document /></el-icon>
                                            <strong>{{ scope.row.tableName }}</strong>
                                        </div>
                                    </template>
                                </el-table-column>
                                <el-table-column prop="tableType" label="类型" width="120" sortable>
                                    <template #default="scope">
                                        <el-tag :type="scope.row.tableType === 'TABLE' ? 'success' : 'info'" size="small">
                                            {{ scope.row.tableType }}
                                        </el-tag>
                                    </template>
                                </el-table-column>
                                <el-table-column prop="remarks" label="备注" min-width="200" show-overflow-tooltip>
                                    <template #default="scope">
                                        {{ scope.row.remarks || '-' }}
                                    </template>
                                </el-table-column>
                                <el-table-column prop="columnCount" label="字段数" width="100" sortable>
                                    <template #default="scope">
                                        <el-tag size="small">{{ scope.row.columnCount || 0 }}</el-tag>
                                    </template>
                                </el-table-column>
                                <el-table-column label="操作" width="150" fixed="right">
                                    <template #default="scope">
                                        <el-button type="primary" size="small" @click="viewTableDetail(scope.row.tableName)">
                                            <el-icon><View /></el-icon>
                                            详情
                                        </el-button>
                                    </template>
                                </el-table-column>
                            </el-table>
                        </div>
                    </el-card>

                    <!-- 表详情 -->
                    <el-card v-if="selectedTable" shadow="hover">
                        <template #header>
                            <div style="display: flex; align-items: center; justify-content: space-between;">
                                <div style="display: flex; align-items: center; gap: 8px;">
                                    <el-icon><Document /></el-icon>
                                    <span style="font-weight: 600;">表详情: {{ selectedTable.tableName }}</span>
                                    <el-tag type="info" size="small">{{ selectedTable.tableType }}</el-tag>
                                </div>
                                <div style="display: flex; gap: 8px;">
                                    <el-button type="primary" size="small" @click="exportTableInfo">
                                        <el-icon><Download /></el-icon>
                                        导出
                                    </el-button>
                                    <el-button size="small" @click="selectedTable = null">
                                        <el-icon><Close /></el-icon>
                                        关闭
                                    </el-button>
                                </div>
                            </div>
                        </template>

                        <el-tabs type="border-card">
                            <el-tab-pane label="字段信息">
                                <template #label>
                                    <span style="display: flex; align-items: center; gap: 4px;">
                                        <el-icon><List /></el-icon>
                                        字段信息 ({{ selectedTable.columns?.length || 0 }})
                                    </span>
                                </template>
                                <el-table :data="selectedTable.columns" stripe border style="width: 100%" height="400">
                                    <el-table-column prop="columnName" label="字段名" width="180" fixed>
                                        <template #default="scope">
                                            <div style="display: flex; align-items: center; gap: 6px;">
                                                <el-icon v-if="scope.row.primaryKey" color="#f56c6c" size="14"><Key /></el-icon>
                                                <strong>{{ scope.row.columnName }}</strong>
                                            </div>
                                        </template>
                                    </el-table-column>
                                    <el-table-column prop="typeName" label="类型" width="120" sortable>
                                        <template #default="scope">
                                            {{ scope.row.typeName }}
                                        </template>
                                    </el-table-column>
                                    <el-table-column prop="columnSize" label="大小" width="80" sortable>
                                        <template #default="scope">
                                            {{ scope.row.columnSize > 0 ? scope.row.columnSize : '-' }}
                                        </template>
                                    </el-table-column>
                                    <el-table-column label="可空" width="80" sortable>
                                        <template #default="scope">
                                            <el-tag :type="scope.row.nullable ? 'info' : 'warning'" size="small">
                                                {{ scope.row.nullable ? '是' : '否' }}
                                            </el-tag>
                                        </template>
                                    </el-table-column>
                                    <el-table-column prop="columnDef" label="默认值" width="120">
                                        <template #default="scope">
                                            {{ scope.row.columnDef || '-' }}
                                        </template>
                                    </el-table-column>
                                    <el-table-column prop="remarks" label="备注" min-width="200" show-overflow-tooltip>
                                        <template #default="scope">
                                            {{ scope.row.remarks || '-' }}
                                        </template>
                                    </el-table-column>
                                    <el-table-column label="自增" width="80">
                                        <template #default="scope">
                                            <el-tag v-if="scope.row.autoIncrement" type="success" size="small">是</el-tag>
                                            <span v-else>-</span>
                                        </template>
                                    </el-table-column>
                                </el-table>
                            </el-tab-pane>

                            <el-tab-pane label="索引信息">
                                <template #label>
                                    <span style="display: flex; align-items: center; gap: 4px;">
                                        <el-icon><Key /></el-icon>
                                        索引信息 ({{ selectedTable.indexes?.length || 0 }})
                                    </span>
                                </template>
                                <el-empty v-if="!selectedTable.indexes || selectedTable.indexes.length === 0" description="无索引信息"></el-empty>
                                <el-table v-else :data="selectedTable.indexes" stripe border style="width: 100%">
                                    <el-table-column prop="indexName" label="索引名" width="200">
                                        <template #default="scope">
                                            {{ scope.row.indexName }}
                                        </template>
                                    </el-table-column>
                                    <el-table-column prop="columnName" label="列名" width="180">
                                        <template #default="scope">
                                            {{ scope.row.columnName }}
                                        </template>
                                    </el-table-column>
                                    <el-table-column label="唯一" width="100">
                                        <template #default="scope">
                                            <el-tag :type="scope.row.nonUnique ? 'info' : 'success'" size="small">
                                                {{ scope.row.nonUnique ? '否' : '是' }}
                                            </el-tag>
                                        </template>
                                    </el-table-column>
                                    <el-table-column prop="type" label="类型" min-width="150">
                                        <template #default="scope">
                                            {{ scope.row.type || '-' }}
                                        </template>
                                    </el-table-column>
                                    <el-table-column label="排序" width="100">
                                        <template #default="scope">
                                            {{ scope.row.ascOrDesc || 'ASC' }}
                                        </template>
                                    </el-table-column>
                                </el-table>
                            </el-tab-pane>

                            <el-tab-pane label="SQL预览">
                                <template #label>
                                    <span style="display: flex; align-items: center; gap: 4px;">
                                        <el-icon><DocumentCopy /></el-icon>
                                        SQL预览
                                    </span>
                                </template>
                                <el-card shadow="never">
                                    <template #header>
                                        <div style="display: flex; align-items: center; justify-content: space-between;">
                                            <span>CREATE TABLE 语句</span>
                                            <el-button type="primary" size="small" @click="copySql">
                                                <el-icon><DocumentCopy /></el-icon>
                                                复制
                                            </el-button>
                                        </div>
                                    </template>
                                    <el-input
                                        type="textarea"
                                        :rows="15"
                                        v-model="generateCreateTableSql"
                                        readonly
                                        style="font-family: 'Courier New', monospace;"
                                    ></el-input>
                                </el-card>
                            </el-tab-pane>
                        </el-tabs>
                    </el-card>
                </div>

                <!-- SQL 执行器 -->
                <div v-if="currentView === 'sql'">
                    <el-card shadow="hover" style="margin-bottom: 20px;">
                        <template #header>
                            <div style="display: flex; align-items: center; justify-content: space-between;">
                                <div style="display: flex; align-items: center; gap: 8px;">
                                    <el-icon><Lightning /></el-icon>
                                    <span style="font-weight: 600;">SQL 执行器</span>
                                </div>
                                <div style="display: flex; gap: 8px;">
                                    <el-select
                                        v-model="sqlDataSource"
                                        placeholder="选择数据源"
                                        style="width: 200px;"
                                        clearable>
                                        <el-option
                                            v-for="ds in dataSources"
                                            :key="ds.name"
                                            :label="ds.name"
                                            :value="ds.name">
                                            <div style="display: flex; align-items: center; gap: 8px;">
                                                <el-icon v-if="ds.primary" color="#f56c6c"><Star /></el-icon>
                                                <span>{{ ds.name }}</span>
                                                <el-tag size="small" :type="getDatabaseTypeColor(ds.databaseType)">{{ ds.databaseType }}</el-tag>
                                            </div>
                                        </el-option>
                                    </el-select>
                                    <el-button type="primary" @click="executeSql" :loading="executingSql" :disabled="!sqlDataSource || !sqlText">
                                        <el-icon><CaretRight /></el-icon>
                                        执行
                                    </el-button>
                                    <el-button @click="clearSql">
                                        <el-icon><Delete /></el-icon>
                                        清空
                                    </el-button>
                                </div>
                            </div>
                        </template>
                        
                        <el-alert
                            title="仅支持SELECT查询语句"
                            type="warning"
                            description="为了安全考虑，SQL执行器只允许执行查询语句，不支持INSERT、UPDATE、DELETE等修改操作"
                            :closable="false"
                            show-icon
                            style="margin-bottom: 15px;">
                        </el-alert>
                        
                        <el-input
                            v-model="sqlText"
                            type="textarea"
                            :rows="8"
                            placeholder="请输入SELECT查询语句..."
                            style="margin-bottom: 15px; font-family: 'Courier New', monospace;"
                            resize="none">
                        </el-input>
                        
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
                            <div>
                                <el-tag v-if="sqlResult" type="success" size="small">
                                    <el-icon><SuccessFilled /></el-icon>
                                    查询成功: {{ sqlResult.rowCount }} 行数据
                                </el-tag>
                                <el-tag v-if="sqlResult && sqlResult.hasMore" type="warning" size="small">
                                    <el-icon><Warning /></el-icon>
                                    数据已截断(最多显示1000行)
                                </el-tag>
                            </div>
                            <el-button-group>
                                <el-button size="small" @click="formatSql">
                                    <el-icon><MagicStick /></el-icon>
                                    格式化
                                </el-button>
                                <el-button size="small" @click="showSqlHistory = true">
                                    <el-icon><Clock /></el-icon>
                                    历史记录
                                </el-button>
                            </el-button-group>
                        </div>
                    </el-card>
                    
                    <!-- 查询结果 -->
                    <el-card v-if="sqlResult && sqlResult.success" shadow="hover">
                        <template #header>
                            <div style="display: flex; align-items: center; justify-content: space-between;">
                                <div style="display: flex; align-items: center; gap: 8px;">
                                    <el-icon><Document /></el-icon>
                                    <span style="font-weight: 600;">查询结果</span>
                                    <el-tag type="success" size="small">{{ sqlResult.rowCount }} 行</el-tag>
                                    <el-tag v-if="sqlResult.columns" type="info" size="small">{{ sqlResult.columns.length }} 列</el-tag>
                                </div>
                                <div>
                                    <el-button type="primary" size="small" @click="exportSqlResult">
                                        <el-icon><Download /></el-icon>
                                        导出结果
                                    </el-button>
                                </div>
                            </div>
                        </template>
                        
                        <el-table
                            :data="sqlResult.data"
                            stripe
                            border
                            style="width: 100%"
                            height="500"
                            v-loading="executingSql">
                            <el-table-column
                                v-for="column in sqlResult.columns"
                                :key="column.name"
                                :prop="column.name"
                                :label="column.name"
                                width="200"
                                show-overflow-tooltip>
                                <template #header>
                                    <div style="display: flex; flex-direction: column; gap: 4px;">
                                        <span style="font-weight: 600; font-size: 12px;">{{ column.name }}</span>
                                        <el-tag size="small" type="info" style="font-size: 10px;">{{ column.type }}</el-tag>
                                    </div>
                                </template>
                                <template #default="scope">
                                    <div style="display: flex; align-items: center; gap: 6px;">
                                        <span 
                                            style="font-family: 'Courier New', monospace; font-size: 12px; flex: 1; overflow: hidden; text-overflow: ellipsis; white-space: nowrap;"
                                            :class="{'null-value': scope.row[column.name] === null || scope.row[column.name] === undefined}">
                                            {{ formatCellValue(scope.row[column.name]) }}
                                        </span>
                                        <el-button 
                                            v-if="shouldShowViewButton(scope.row[column.name])"
                                            type="primary" 
                                            size="small" 
                                            text
                                            @click="viewCellData(column.name, scope.row[column.name], column.type)"
                                            style="padding: 2px 4px; min-width: auto;">
                                            <el-icon size="14"><View /></el-icon>
                                        </el-button>
                                    </div>
                                </template>
                            </el-table-column>
                        </el-table>
                    </el-card>
                    
                    <!-- 单元格数据查看对话框 -->
                    <el-dialog
                        v-model="cellDataDialog.visible"
                        :title="cellDataDialog.title"
                        width="600px"
                        :close-on-click-modal="true">
                        <div style="max-height: 500px; overflow-y: auto;">
                            <el-alert 
                                :title="`数据类型: ${cellDataDialog.type}`" 
                                type="info" 
                                :closable="false"
                                style="margin-bottom: 15px;">
                            </el-alert>
                            <el-input
                                v-model="cellDataDialog.content"
                                type="textarea"
                                :rows="15"
                                readonly
                                style="font-family: 'Courier New', monospace; font-size: 13px;">
                            </el-input>
                        </div>
                        <template #footer>
                            <div style="display: flex; justify-content: space-between; align-items: center;">
                                <el-tag size="small">长度: {{ cellDataDialog.content ? cellDataDialog.content.length : 0 }} 字符</el-tag>
                                <div>
                                    <el-button @click="copyCellData">
                                        <el-icon><DocumentCopy /></el-icon>
                                        复制
                                    </el-button>
                                    <el-button type="primary" @click="cellDataDialog.visible = false">关闭</el-button>
                                </div>
                            </div>
                        </template>
                    </el-dialog>
                    
                    <!-- 错误信息 -->
                    <el-card v-if="sqlResult && !sqlResult.success" shadow="hover" style="border-left: 4px solid #f56c6c;">
                        <template #header>
                            <div style="display: flex; align-items: center; gap: 8px;">
                                <el-icon color="#f56c6c"><CircleCloseFilled /></el-icon>
                                <span style="font-weight: 600; color: #f56c6c;">执行错误</span>
                            </div>
                        </template>
                        <div style="color: #f56c6c; font-family: 'Courier New', monospace; padding: 10px; background: #fef0f0; border-radius: 4px;">
                            {{ sqlResult.message }}
                        </div>
                    </el-card>
                </div>

                <!-- 代码生成 -->
                <div v-if="currentView === 'codegen'">
                    <el-card shadow="hover">
                        <template #header>
                            <div style="display: flex; align-items: center; gap: 8px;">
                                <el-icon><Tools /></el-icon>
                                <span style="font-weight: 600;">代码生成</span>
                            </div>
                        </template>
                        <el-alert
                            title="此功能即将推出"
                            type="info"
                            description="支持MyBatis、JPA、Spring Data JPA等多种框架的代码生成..."
                            :closable="false"
                            show-icon>
                        </el-alert>
                        <div style="margin-top: 20px; padding: 40px; text-align: center; color: #909399;">
                            <el-icon size="48"><Clock /></el-icon>
                            <p style="margin-top: 16px;">敬请期待</p>
                        </div>
                    </el-card>
                </div>
            </el-main>
        </el-container>
    </el-container>
</div>

<script>
    const {createApp} = Vue;

    const app = createApp({
        data() {
            return {
                currentView: 'dashboard',
                menuItems: [
                    {key: 'dashboard', label: 'Dashboard', icon: 'HomeFilled'},
                    {key: 'datasources', label: '数据源', icon: 'Connection'},
                    {key: 'tables', label: '表结构', icon: 'Folder'},
                    {key: 'sql', label: 'SQL 执行器', icon: 'Lightning'},
                    {key: 'codegen', label: '代码生成', icon: 'Tools'}
                ],
                dataSources: [],
                tables: [],
                tableSearch: '',
                selectedDataSource: '',
                selectedTable: null,
                loading: false,
                loadingTables: false,
                // SQL执行器相关
                sqlDataSource: '',
                sqlText: '',
                sqlResult: null,
                executingSql: false,
                showSqlHistory: false,
                sqlHistory: [],
                // 单元格数据查看对话框
                cellDataDialog: {
                    visible: false,
                    title: '',
                    content: '',
                    type: ''
                }
            };
        },
        computed: {
            currentViewTitle() {
                const item = this.menuItems.find(m => m.key === this.currentView);
                return item ? item.label : '';
            },
            filteredTables() {
                if (!this.tableSearch) return this.tables;
                const search = this.tableSearch.toLowerCase();
                return this.tables.filter(t => t.tableName.toLowerCase().includes(search));
            },
            generateCreateTableSql() {
                if (!this.selectedTable || !this.selectedTable.columns) return '';
                
                const tableName = this.selectedTable.tableName;
                const columns = this.selectedTable.columns.map(col => {
                    let sql = `  \`${col.columnName}\` ${col.typeName}`;
                    if (col.columnSize > 0) {
                        sql += `(${col.columnSize})`;
                    }
                    if (!col.nullable) {
                        sql += ' NOT NULL';
                    }
                    if (col.autoIncrement) {
                        sql += ' AUTO_INCREMENT';
                    }
                    if (col.columnDef) {
                        sql += ` DEFAULT '${col.columnDef}'`;
                    }
                    if (col.remarks) {
                        sql += ` COMMENT '${col.remarks}'`;
                    }
                    return sql;
                }).join(',\n');
                
                return `CREATE TABLE \`${tableName}\` (\n${columns}\n) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='${this.selectedTable.remarks || ''}';`;
            }
        },
        methods: {
            handleMenuSelect(key) {
                this.currentView = key;
                if ((key === 'datasources' || key === 'tables') && this.dataSources.length === 0) {
                    this.loadDataSources();
                }
            },
            
            refreshCurrentView() {
                if (this.currentView === 'datasources') {
                    this.loadDataSources();
                } else if (this.currentView === 'tables' && this.selectedDataSource) {
                    this.loadTables();
                } else {
                    this.$message.info('当前视图已刷新');
                }
            },
            
            getDatabaseTypeColor(type) {
                const typeMap = {
                    'MySQL': 'success',
                    'PostgreSQL': 'warning',
                    'Oracle': 'danger',
                    'SQL Server': 'info'
                };
                return typeMap[type] || 'info';
            },
            
            async loadDataSources() {
                this.loading = true;
                try {
                    const response = await axios.get('./api/datasource/list');
                    console.log('Data sources response:', response.data);
                    if (response.data.code === 200) {
                        console.log("加载数据源成功:", response.data.data);
                        this.dataSources = response.data.data.map(ds => ({
                            ...ds,
                            status: 'success'
                        }));
                        this.$message.success(`成功加载 ${this.dataSources.length} 个数据源`);
                    } else {
                        this.$message.error('加载数据源失败: ' + response.data.message);
                    }
                } catch (error) {
                    console.error('Failed to load data sources:', error);
                    this.$message.error('加载数据源失败: ' + error.message);
                } finally {
                    this.loading = false;
                }
            },
            
            async testConnection(dataSource) {
                try {
                    const response = await axios.post('./api/datasource/test', {
                        name: dataSource.name
                    });
                    if (response.data.code === 200) {
                        this.$message.success(`数据源 "${dataSource.name}" 连接成功`);
                        dataSource.status = 'success';
                    } else {
                        this.$message.error(`数据源 "${dataSource.name}" 连接失败: ` + response.data.message);
                        dataSource.status = 'error';
                    }
                } catch (error) {
                    this.$message.error(`测试连接失败: ` + error.message);
                    dataSource.status = 'error';
                }
            },
            
            async testAllConnections() {
                const loading = this.$loading({
                    lock: true,
                    text: '正在测试所有连接...',
                    background: 'rgba(0, 0, 0, 0.7)'
                });
                
                try {
                    const promises = this.dataSources.map(ds => this.testConnection(ds));
                    await Promise.all(promises);
                    this.$message.success('所有连接测试完成');
                } finally {
                    loading.close();
                }
            },
            
            editDataSource(dataSource) {
                this.$message.info(`编辑数据源: ${dataSource.name}`);
            },
            
            deleteDataSource(dataSource) {
                this.$confirm(`确定要删除数据源 "${dataSource.name}" 吗？`, '提示', {
                    type: 'warning'
                }).then(async () => {
                    try {
                        const response = await axios.delete(`./api/datasource/${dataSource.name}`);
                        if (response.data.code === 200) {
                            this.$message.success('删除成功');
                            this.loadDataSources();
                        } else {
                            this.$message.error('删除失败: ' + response.data.message);
                        }
                    } catch (error) {
                        this.$message.error('删除失败: ' + error.message);
                    }
                }).catch(() => {});
            },
            
            async loadTables() {
                if (!this.selectedDataSource) return;

                this.loadingTables = true;
                this.selectedTable = null;
                this.tableSearch = '';
                try {
                    const response = await axios.get('./api/metadata/tables', {
                        params: {dataSourceName: this.selectedDataSource}
                    });
                    console.log('Tables response:', response.data);
                    if (response.data.code === 200) {
                        this.tables = response.data.data;
                        this.$message.success(`成功加载 ${this.tables.length} 个表`);
                    } else {
                        this.$message.error('加载表列表失败: ' + response.data.message);
                    }
                } catch (error) {
                    console.error('Failed to load tables:', error);
                    this.$message.error('加载表列表失败: ' + error.message);
                } finally {
                    this.loadingTables = false;
                }
            },
            
            async viewTableDetail(tableName) {
                const loading = this.$loading({
                    lock: true,
                    text: '正在加载表详情...',
                    background: 'rgba(0, 0, 0, 0.7)'
                });
                try {
                    const response = await axios.get(`./api/metadata/table/${tableName}`, {
                        params: {dataSourceName: this.selectedDataSource}
                    });
                    console.log('Table detail response:', response.data);
                    if (response.data.code === 200) {
                        this.selectedTable = response.data.data;
                        this.$message.success('加载表详情成功');
                    } else {
                        this.$message.error('加载表详情失败: ' + response.data.message);
                    }
                } catch (error) {
                    console.error('Failed to load table detail:', error);
                    this.$message.error('加载表详情失败: ' + error.message);
                } finally {
                    loading.close();
                }
            },
            
            exportTableInfo() {
                if (!this.selectedTable) return;
                
                const data = JSON.stringify(this.selectedTable, null, 2);
                const blob = new Blob([data], {type: 'application/json'});
                const url = URL.createObjectURL(blob);
                const link = document.createElement('a');
                link.href = url;
                link.download = `${this.selectedTable.tableName}.json`;
                link.click();
                URL.revokeObjectURL(url);
                
                this.$message.success('导出成功');
            },
            
            copySql() {
                navigator.clipboard.writeText(this.generateCreateTableSql).then(() => {
                    this.$message.success('SQL已复制到剪贴板');
                }).catch(() => {
                    this.$message.error('复制失败');
                });
            },
            
            // SQL执行相关方法
            async executeSql() {
                if (!this.sqlDataSource || !this.sqlText.trim()) {
                    this.$message.warning('请选择数据源并输入SQL语句');
                    return;
                }
                
                this.executingSql = true;
                try {
                    const request = {
                        dataSourceName: this.sqlDataSource,
                        sql: this.sqlText.trim(),
                        params: []
                    };
                    
                    const response = await axios.post('./api/sql/execute', request);
                    if (response.data.code === 200) {
                        this.sqlResult = {
                            success: true,
                            columns: response.data.data.columns,
                            data: response.data.data.data,
                            rowCount: response.data.data.rowCount,
                            hasMore: response.data.data.hasMore,
                            message: '查询成功'
                        };
                        this.$message.success('SQL执行成功');
                        
                        // 添加到历史记录
                        this.addToSqlHistory(this.sqlText.trim());
                    } else {
                        this.sqlResult = {
                            success: false,
                            message: response.data.message
                        };
                        this.$message.error('SQL执行失败: ' + response.data.message);
                    }
                } catch (error) {
                    this.sqlResult = {
                        success: false,
                        message: error.message
                    };
                    this.$message.error('SQL执行错误: ' + error.message);
                } finally {
                    this.executingSql = false;
                }
            },
            
            clearSql() {
                this.sqlText = '';
                this.sqlResult = null;
                this.$message.info('已清空SQL');
            },
            
            formatSql() {
                if (!this.sqlText.trim()) {
                    this.$message.warning('请先输入SQL语句');
                    return;
                }
                
                try {
                    // 简单的SQL格式化
                    let sql = this.sqlText.trim();
                    // 将SELECT、FROM、WHERE等关键字换行
                    sql = sql.replace(/\b(SELECT|FROM|WHERE|ORDER BY|GROUP BY|HAVING|JOIN|LEFT JOIN|RIGHT JOIN|INNER JOIN)\b/gi, '\n$1');
                    // 移除多余的空行
                    sql = sql.replace(/\n\s*\n/g, '\n');
                    // 缩进处理
                    let lines = sql.split('\n');
                    let indentLevel = 0;
                    lines = lines.map(line => {
                        line = line.trim();
                        if (!line) return '';
                        
                        // 减少缩进
                        if (line.startsWith('FROM') || line.startsWith('WHERE') ||
                            line.startsWith('ORDER BY') || line.startsWith('GROUP BY') ||
                            line.startsWith('HAVING')) {
                            indentLevel = Math.max(0, indentLevel - 1);
                        }
                        
                        const indentedLine = '  '.repeat(indentLevel) + line;
                        
                        // 增加缩进
                        if (line.startsWith('SELECT') || line.startsWith('FROM') ||
                            line.startsWith('WHERE') || line.includes('JOIN')) {
                            indentLevel++;
                        }
                        
                        return indentedLine;
                    });
                    
                    this.sqlText = lines.filter(line => line !== '').join('\n');
                    this.$message.success('SQL格式化完成');
                } catch (error) {
                    this.$message.warning('格式化失败，请检查SQL语法');
                }
            },
            
            addToSqlHistory(sql) {
                // 避免重复添加相同的SQL
                const existingIndex = this.sqlHistory.indexOf(sql);
                if (existingIndex !== -1) {
                    this.sqlHistory.splice(existingIndex, 1);
                }
                
                // 添加到开头
                this.sqlHistory.unshift(sql);
                
                // 限制历史记录数量
                if (this.sqlHistory.length > 50) {
                    this.sqlHistory = this.sqlHistory.slice(0, 50);
                }
            },
            
            exportSqlResult() {
                if (!this.sqlResult || !this.sqlResult.success) {
                    this.$message.warning('没有可导出的查询结果');
                    return;
                }
                
                try {
                    // 生成CSV内容
                    let csvContent = '';
                    
                    // 添加列标题
                    const headers = this.sqlResult.columns.map(col => col.name);
                    csvContent += headers.join(',') + '\n';
                    
                    // 添加数据行
                    this.sqlResult.data.forEach(row => {
                        const values = headers.map(header => {
                            const value = row[header];
                            if (value === null || value === undefined) {
                                return 'NULL';
                            }
                            // 如果值包含逗号、换行符或引号，需要用引号包围并转义
                            if (typeof value === 'string' && (value.includes(',') || value.includes('\n') || value.includes('"'))) {
                                return '"' + value.replace(/"/g, '""') + '"';
                            }
                            return String(value);
                        });
                        csvContent += values.join(',') + '\n';
                    });
                    
                    // 创建并下载文件
                    const blob = new Blob(['\ufeff' + csvContent], {type: 'text/csv;charset=utf-8;'});
                    const link = document.createElement('a');
                    const url = URL.createObjectURL(blob);
                    link.href = url;
                    link.download = `query_result_${new Date().getTime()}.csv`;
                    link.click();
                    URL.revokeObjectURL(url);
                    
                    this.$message.success('导出成功');
                } catch (error) {
                    this.$message.error('导出失败: ' + error.message);
                }
            },
            
            // 格式化单元格值
            formatCellValue(value) {
                if (value === null || value === undefined) {
                    return 'NULL';
                }
                const strValue = String(value);
                // 如果超过50个字符，截断显示
                if (strValue.length > 50) {
                    return strValue.substring(0, 50) + '...';
                }
                return strValue;
            },
            
            // 判断是否显示查看按钮
            shouldShowViewButton(value) {
                if (value === null || value === undefined) {
                    return false;
                }
                const strValue = String(value);
                // 超过50个字符或包含换行符时显示查看按钮
                return strValue.length > 50 || strValue.includes('\n');
            },
            
            // 查看单元格完整数据
            viewCellData(columnName, value, type) {
                this.cellDataDialog.title = `查看字段: ${columnName}`;
                this.cellDataDialog.content = value === null || value === undefined ? 'NULL' : String(value);
                this.cellDataDialog.type = type;
                this.cellDataDialog.visible = true;
            },
            
            // 复制单元格数据
            copyCellData() {
                navigator.clipboard.writeText(this.cellDataDialog.content).then(() => {
                    this.$message.success('数据已复制到剪贴板');
                }).catch(() => {
                    this.$message.error('复制失败');
                });
            }
        },
        mounted() {
            console.log('DB Dev UI initialized with Element Plus');
            this.loadDataSources();
        }
    });

    // 注册所有 Element Plus 图标
    for (const [key, component] of Object.entries(ElementPlusIconsVue)) {
        app.component(key, component);
    }

    app.use(ElementPlus);
    app.mount('#app');
</script>
</body>
</html>
